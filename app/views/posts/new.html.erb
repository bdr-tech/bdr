<% content_for :title, "새 게시글 작성 - BDR 커뮤니티" %>

<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4">
    <!-- 헤더 -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
      <div class="flex justify-between items-center">
        <h1 class="text-2xl font-bold text-gray-800">✏️ 새 게시글 작성</h1>
        <%= link_to "← 목록으로", community_path, class: "text-gray-600 hover:text-gray-800 transition duration-300" %>
      </div>
    </div>

    <!-- 작성 폼 -->
    <div class="bg-white rounded-lg shadow-lg p-8">
      <%= form_with model: @post, local: true, class: "space-y-6" do |form| %>
        <% if @post.errors.any? %>
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <h3 class="text-red-800 font-semibold mb-2">오류가 발생했습니다:</h3>
            <ul class="text-red-700 text-sm space-y-1">
              <% @post.errors.full_messages.each do |message| %>
                <li>• <%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- 카테고리 선택 -->
        <div>
          <%= form.label :category, "게시판 선택", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <% Post::CATEGORIES.each do |category, description| %>
              <label class="category-option cursor-pointer">
                <%= form.radio_button :category, category, 
                      value: category,
                      checked: (params[:category] == category),
                      class: "sr-only category-radio" %>
                <div class="category-card border-2 border-gray-200 rounded-lg p-4 text-center hover:border-orange-300 transition-all duration-300">
                  <div class="text-2xl mb-2"><%= Post.new(category: category).category_icon %></div>
                  <div class="font-semibold text-gray-800 text-sm"><%= category %></div>
                  <div class="text-xs text-gray-600 mt-1"><%= description %></div>
                </div>
              </label>
            <% end %>
          </div>
        </div>

        <!-- 제목 -->
        <div>
          <%= form.label :title, "제목", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :title, 
                class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                placeholder: "제목을 입력하세요 (2-100자)" %>
        </div>

        <!-- 내용 -->
        <div>
          <%= form.label :content, "내용", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_area :content, rows: 12,
                class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                placeholder: "내용을 입력하세요 (최소 5자 이상)" %>
        </div>

        <!-- 이미지 업로드 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <%= form.label :image1, "첫 번째 이미지", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.url_field :image1,
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "이미지 URL을 입력하세요 (선택사항)" %>
            <p class="text-xs text-gray-500 mt-1">이미지 URL을 입력하세요 (예: https://example.com/image.jpg)</p>
          </div>
          
          <div>
            <%= form.label :image2, "두 번째 이미지", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.url_field :image2,
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "이미지 URL을 입력하세요 (선택사항)" %>
            <p class="text-xs text-gray-500 mt-1">최대 2장까지 첨부 가능합니다</p>
          </div>
        </div>

        <!-- 작성 안내 -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <h3 class="font-semibold text-blue-800 mb-2">📝 작성 가이드</h3>
          <ul class="text-blue-700 text-sm space-y-1">
            <li>• 서로 존중하는 마음으로 글을 작성해주세요</li>
            <li>• 개인정보나 연락처는 공개하지 마세요</li>
            <li>• 중고거래 시 안전한 거래를 위해 신중히 결정하세요</li>
            <li>• 부적절한 내용은 관리자에 의해 삭제될 수 있습니다</li>
          </ul>
        </div>

        <!-- 버튼 -->
        <div class="flex justify-between pt-6">
          <%= link_to "취소", community_path, class: "px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300" %>
          <%= form.submit "게시글 작성", 
                class: "px-8 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition duration-300 transform hover:scale-105" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 카테고리 선택 기능
  document.querySelectorAll('.category-option').forEach(option => {
    option.addEventListener('click', function() {
      // 모든 카테고리 옵션 초기화
      document.querySelectorAll('.category-card').forEach(card => {
        card.classList.remove('border-orange-500', 'bg-orange-50');
        card.classList.add('border-gray-200');
      });
      
      // 선택한 카테고리 활성화
      const card = this.querySelector('.category-card');
      card.classList.remove('border-gray-200');
      card.classList.add('border-orange-500', 'bg-orange-50');
      
      // 라디오 버튼 체크
      this.querySelector('.category-radio').checked = true;
    });
  });
  
  // 페이지 로드 시 선택된 카테고리 표시
  const checkedRadio = document.querySelector('.category-radio:checked');
  if (checkedRadio) {
    const card = checkedRadio.parentElement.querySelector('.category-card');
    card.classList.remove('border-gray-200');
    card.classList.add('border-orange-500', 'bg-orange-50');
  }
});
</script>