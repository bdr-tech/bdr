<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-7xl mx-auto px-4">
    <!-- í—¤ë” -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h1 class="text-3xl font-bold text-gray-800 mb-2">
            ğŸ€ <%= @court.name %> ì‹¤ì‹œê°„ í˜„í™©
          </h1>
          <p class="text-gray-600"><%= @court.address %></p>
        </div>
        <%= link_to "â† ì½”íŠ¸ ì •ë³´", court_path(@court), 
            class: "text-orange-600 hover:text-orange-800 transition duration-300" %>
      </div>
      
      <!-- ì‹¤ì‹œê°„ í˜¼ì¡ë„ -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="bg-<%= @court.occupancy_color %>-50 border-2 border-<%= @court.occupancy_color %>-200 rounded-lg p-6 text-center">
          <div class="text-4xl font-bold text-<%= @court.occupancy_color %>-600 mb-2">
            <%= @court.current_occupancy %>/<%= @court.capacity %>
          </div>
          <div class="text-<%= @court.occupancy_color %>-800 font-semibold">
            <%= case @court.occupancy_level
                when 'empty' then 'ë¹„ì–´ìˆìŒ'
                when 'low' then 'ì—¬ìœ '
                when 'moderate' then 'ë³´í†µ'
                when 'busy' then 'í˜¼ì¡'
                when 'full' then 'ë§Œì›'
                end %>
          </div>
          <% if @court.estimated_wait_time > 0 %>
            <div class="text-sm text-<%= @court.occupancy_color %>-600 mt-2">
              ì˜ˆìƒ ëŒ€ê¸°: <%= @court.estimated_wait_time %>ë¶„
            </div>
          <% end %>
        </div>
        
        <div class="bg-blue-50 rounded-lg p-6 text-center">
          <div class="text-3xl mb-2">â°</div>
          <div class="text-lg font-semibold text-blue-800">í”¼í¬ íƒ€ì„</div>
          <div class="text-blue-600"><%= @today_stats[:peak_time] %></div>
        </div>
        
        <div class="bg-purple-50 rounded-lg p-6 text-center">
          <div class="text-3xl mb-2">ğŸ‘¥</div>
          <div class="text-lg font-semibold text-purple-800">ì˜¤ëŠ˜ ë°©ë¬¸</div>
          <div class="text-2xl text-purple-600"><%= @today_stats[:total_players] %>ëª…</div>
        </div>
        
        <div class="bg-yellow-50 rounded-lg p-6 text-center">
          <div class="text-3xl mb-2">ğŸ“Š</div>
          <div class="text-lg font-semibold text-yellow-800">ìµœë‹¤ ì‹œê°„</div>
          <div class="text-yellow-600"><%= @today_stats[:busiest_hour] %>ì‹œ</div>
        </div>
      </div>
    </div>
    
    <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ¯ ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- ì²´í¬ì¸ -->
        <div class="text-center">
          <button onclick="checkIn()" 
                  class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-lg transition duration-300">
            <span class="text-2xl mb-2 block">âœ…</span>
            ì²´í¬ì¸
          </button>
          <p class="text-sm text-gray-600 mt-2">ì½”íŠ¸ì— ë„ì°©í–ˆì–´ìš”</p>
        </div>
        
        <!-- ê²½ê¸° ë¦¬í¬íŠ¸ -->
        <div class="text-center">
          <button onclick="showReportModal()" 
                  class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-lg transition duration-300">
            <span class="text-2xl mb-2 block">ğŸ“¢</span>
            í˜„ì¬ ìƒí™© ë¦¬í¬íŠ¸
          </button>
          <p class="text-sm text-gray-600 mt-2">í˜„ì¬ ì¸ì›ìˆ˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”</p>
        </div>
        
        <!-- ì²´í¬ì•„ì›ƒ -->
        <div class="text-center">
          <button onclick="checkOut()" 
                  class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-6 rounded-lg transition duration-300">
            <span class="text-2xl mb-2 block">ğŸ‘‹</span>
            ì²´í¬ì•„ì›ƒ
          </button>
          <p class="text-sm text-gray-600 mt-2">ì½”íŠ¸ë¥¼ ë– ë‚¬ì–´ìš”</p>
        </div>
      </div>
    </div>
    
    <!-- í”¼í¬ ì‹œê°„ ê·¸ë˜í”„ -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ˆ ì‹œê°„ëŒ€ë³„ í‰ê·  ì¸ì›</h2>
      <div class="h-64 relative">
        <canvas id="peakHoursChart"></canvas>
      </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- í˜„ì¬ í™œë™ ì¤‘ì¸ ì‚¬ìš©ì -->
      <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">
          ğŸ‘‘ í˜„ì¬ í™œë™ ì¤‘ (<%= @active_users&.count || 0 %>ëª…)
        </h2>
        
        <% if @active_users&.any? %>
          <div class="space-y-3">
            <% @active_users.each do |user| %>
              <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold">
                  <%= user.nickname&.first&.upcase || user.name&.first&.upcase || 'U' %>
                </div>
                <div>
                  <div class="font-semibold text-gray-800">
                    <%= user.nickname || user.name %>
                  </div>
                  <div class="text-sm text-gray-600">
                    <%= user.evaluation_rating_percentage %>% í‰ì 
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-gray-500 text-center py-8">í˜„ì¬ ì²´í¬ì¸í•œ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤</p>
        <% end %>
      </div>
      
      <!-- ìµœê·¼ í™œë™ ë‚´ì—­ -->
      <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“‹ ìµœê·¼ í™œë™ ë‚´ì—­</h2>
        
        <% if @recent_activities.any? %>
          <div class="space-y-3 max-h-96 overflow-y-auto">
            <% @recent_activities.each do |activity| %>
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center space-x-3">
                  <div class="text-2xl">
                    <%= case activity.activity_type
                        when 'check_in' then 'âœ…'
                        when 'check_out' then 'ğŸ‘‹'
                        when 'game_report' then 'ğŸ“¢'
                        else 'ğŸ“'
                        end %>
                  </div>
                  <div>
                    <div class="font-semibold text-gray-800">
                      <%= activity.user.nickname || activity.user.name %>
                    </div>
                    <div class="text-sm text-gray-600">
                      <%= CourtActivity::ACTIVITY_TYPES[activity.activity_type] %>
                      <% if activity.player_count > 1 %>
                        (<%= activity.player_count %>ëª…)
                      <% end %>
                    </div>
                  </div>
                </div>
                <div class="text-sm text-gray-500">
                  <%= time_ago_in_words(activity.recorded_at) %> ì „
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-gray-500 text-center py-8">ì•„ì§ í™œë™ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- ë¦¬í¬íŠ¸ ëª¨ë‹¬ -->
<div id="reportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ€ í˜„ì¬ ì½”íŠ¸ ìƒí™©</h3>
    
    <div class="space-y-4">
      <div>
        <label class="block text-gray-700 font-semibold mb-2">í˜„ì¬ ì¸ì›ìˆ˜</label>
        <input type="number" id="playerCount" min="0" max="<%= @court.capacity %>" 
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="í˜„ì¬ ì½”íŠ¸ì— ìˆëŠ” ì¸ì›ìˆ˜">
      </div>
      
      <div>
        <label class="block text-gray-700 font-semibold mb-2">ê²½ê¸° ìœ í˜• (ì„ íƒ)</label>
        <select id="gameType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
          <option value="3vs3">3ëŒ€3</option>
          <option value="4vs4">4ëŒ€4</option>
          <option value="5vs5">5ëŒ€5</option>
          <option value="practice">ê°œì¸ ì—°ìŠµ</option>
        </select>
      </div>
      
      <div>
        <label class="block text-gray-700 font-semibold mb-2">ë©”ëª¨ (ì„ íƒ)</label>
        <textarea id="notes" rows="3" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="ì¶”ê°€ ì •ë³´ê°€ ìˆë‹¤ë©´ ë‚¨ê²¨ì£¼ì„¸ìš”"></textarea>
      </div>
    </div>
    
    <div class="flex justify-end space-x-3 mt-6">
      <button onclick="hideReportModal()" 
              class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
        ì·¨ì†Œ
      </button>
      <button onclick="submitReport()" 
              class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">
        ë¦¬í¬íŠ¸ ì œì¶œ
      </button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// í”¼í¬ ì‹œê°„ ì°¨íŠ¸
const peakHoursData = <%= @court.peak_hours.to_json %>;
const ctx = document.getElementById('peakHoursChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: Array.from({length: 24}, (_, i) => `${i}ì‹œ`),
    datasets: [{
      label: 'í‰ê·  ì¸ì›',
      data: Array.from({length: 24}, (_, i) => peakHoursData[i.toString()] || 0),
      backgroundColor: 'rgba(59, 130, 246, 0.5)',
      borderColor: 'rgba(59, 130, 246, 1)',
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: {
        beginAtZero: true
      }
    }
  }
});

// ì²´í¬ì¸
function checkIn() {
  if (confirm('ì²´í¬ì¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    fetch('<%= check_in_court_court_activities_path(@court) %>', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
      },
      body: JSON.stringify({
        player_count: 1
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert(data.message);
        location.reload();
      } else {
        alert('ì²´í¬ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + data.errors.join(', '));
      }
    });
  }
}

// ì²´í¬ì•„ì›ƒ
function checkOut() {
  if (confirm('ì²´í¬ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    fetch('<%= check_out_court_court_activities_path(@court) %>', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
      },
      body: JSON.stringify({
        player_count: 1
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert(data.message);
        location.reload();
      } else {
        alert('ì²´í¬ì•„ì›ƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + data.errors.join(', '));
      }
    });
  }
}

// ë¦¬í¬íŠ¸ ëª¨ë‹¬
function showReportModal() {
  document.getElementById('reportModal').classList.remove('hidden');
  document.getElementById('reportModal').classList.add('flex');
}

function hideReportModal() {
  document.getElementById('reportModal').classList.add('hidden');
  document.getElementById('reportModal').classList.remove('flex');
}

// ë¦¬í¬íŠ¸ ì œì¶œ
function submitReport() {
  const playerCount = document.getElementById('playerCount').value;
  if (!playerCount || playerCount < 0) {
    alert('ì¸ì›ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
    return;
  }
  
  fetch('<%= report_court_court_activities_path(@court) %>', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
    },
    body: JSON.stringify({
      player_count: playerCount,
      game_type: document.getElementById('gameType').value,
      notes: document.getElementById('notes').value
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert(data.message);
      hideReportModal();
      location.reload();
    } else {
      alert('ë¦¬í¬íŠ¸ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + data.errors.join(', '));
    }
  });
}

// 30ì´ˆë§ˆë‹¤ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)
setInterval(() => {
  if (document.visibilityState === 'visible') {
    location.reload();
  }
}, 30000);
</script>