<div class="max-w-7xl mx-auto px-4 py-8">
  <!-- ν—¤λ” -->
  <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg shadow-lg p-8 mb-8 text-white">
    <h1 class="text-3xl font-bold mb-4">π† μ—…μ  & ν¬μΈνΈ</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
      <!-- μ „μ²΄ μ§„ν–‰λ¥  -->
      <div class="bg-white/20 backdrop-blur rounded-lg p-4">
        <div class="text-sm opacity-90">μ „μ²΄ μ§„ν–‰λ¥ </div>
        <div class="text-2xl font-bold"><%= @progress_percentage %>%</div>
        <div class="w-full bg-white/30 rounded-full h-2 mt-2">
          <div class="bg-white rounded-full h-2" style="width: <%= @progress_percentage %>%"></div>
        </div>
        <div class="text-xs mt-1 opacity-90"><%= @unlocked_count %> / <%= @total_achievements %>κ° λ‹¬μ„±</div>
      </div>
      
      <!-- μ΄ ν¬μΈνΈ -->
      <div class="bg-white/20 backdrop-blur rounded-lg p-4">
        <div class="text-sm opacity-90">μ΄ ν¬μΈνΈ</div>
        <div class="text-2xl font-bold"><%= number_with_delimiter(@total_points) %>P</div>
        <div class="text-xs mt-1 opacity-90">μ΄λ² λ‹¬: +<%= number_with_delimiter(@points_this_month) %>P</div>
      </div>
      
      <!-- μµκ·Ό μ—…μ  -->
      <div class="bg-white/20 backdrop-blur rounded-lg p-4">
        <div class="text-sm opacity-90">μµκ·Ό νλ“</div>
        <% if @recent_achievements.any? %>
          <div class="text-lg font-bold"><%= @recent_achievements.first.achievement.name %></div>
          <div class="text-xs mt-1 opacity-90"><%= @recent_achievements.first.created_at.strftime('%m/%d') %> λ‹¬μ„±</div>
        <% else %>
          <div class="text-lg">μ•„μ§ μ—†μ</div>
        <% end %>
      </div>
    </div>
  </div>
  
  <!-- νƒ­ λ„¤λΉ„κ²μ΄μ… -->
  <div class="bg-white rounded-lg shadow mb-6">
    <div class="flex border-b">
      <button class="tab-button px-6 py-3 font-semibold text-purple-600 border-b-2 border-purple-600" 
              data-tab="achievements">
        μ—…μ 
      </button>
      <button class="tab-button px-6 py-3 font-semibold text-gray-600 hover:text-gray-800" 
              data-tab="points">
        ν¬μΈνΈ λ‚΄μ—­
      </button>
    </div>
  </div>
  
  <!-- μ—…μ  νƒ­ -->
  <div id="achievements-tab" class="tab-content">
    <% @achievements_by_category.each do |category, achievements| %>
      <div class="mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">
          <%= achievement_category_name(category) %>
          <span class="text-sm font-normal text-gray-500">
            (<%= achievements.count { |a| @unlocked_achievement_ids.include?(a.id) } %>/<%= achievements.count %>)
          </span>
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <% achievements.each do |achievement| %>
            <% unlocked = @unlocked_achievement_ids.include?(achievement.id) %>
            <div class="<%= unlocked ? 'bg-white' : 'bg-gray-100' %> rounded-lg shadow p-4 
                        <%= unlocked ? 'border-2 border-purple-500' : 'opacity-60' %>">
              <div class="flex items-start">
                <div class="text-3xl mr-3">
                  <%= unlocked ? achievement.icon : 'π”’' %>
                </div>
                <div class="flex-1">
                  <h3 class="font-semibold text-gray-800 <%= unlocked ? '' : 'text-gray-600' %>">
                    <%= achievement.name %>
                  </h3>
                  <p class="text-sm text-gray-600 mt-1">
                    <%= achievement.description %>
                  </p>
                  <% if unlocked %>
                    <% user_achievement = @user_achievements.find { |ua| ua.achievement_id == achievement.id } %>
                    <p class="text-xs text-purple-600 mt-2">
                      <%= user_achievement.created_at.strftime('%Y.%m.%d') %> λ‹¬μ„±
                    </p>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
  
  <!-- ν¬μΈνΈ λ‚΄μ—­ νƒ­ -->
  <div id="points-tab" class="tab-content hidden">
    <div class="bg-white rounded-lg shadow">
      <div class="p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">ν¬μΈνΈ νλ“ λ‚΄μ—­</h2>
        
        <% if @points_history.any? %>
          <div class="space-y-3">
            <% @points_history.each do |point| %>
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                  <div class="font-semibold text-gray-800"><%= point.reason %></div>
                  <div class="text-sm text-gray-500"><%= point.earned_at.strftime('%Yλ…„ %mμ›” %dμΌ %H:%M') %></div>
                </div>
                <div class="text-lg font-bold <%= point.points > 0 ? 'text-green-600' : 'text-red-600' %>">
                  <%= point.points > 0 ? '+' : '' %><%= number_with_delimiter(point.points) %>P
                </div>
              </div>
            <% end %>
          </div>
          
          <div class="mt-6 text-center">
            <%= link_to "μ „μ²΄ λ‚΄μ—­ λ³΄κΈ°", points_path, 
                class: "text-purple-600 hover:text-purple-800 font-semibold" %>
          </div>
        <% else %>
          <p class="text-gray-500 text-center py-8">μ•„μ§ ν¬μΈνΈ λ‚΄μ—­μ΄ μ—†μµλ‹λ‹¤.</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
// νƒ­ μ „ν™
document.addEventListener('DOMContentLoaded', function() {
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const targetTab = this.dataset.tab;
      
      // λ¨λ“  νƒ­ λ²„νΌ μ¤νƒ€μΌ μ΄κΈ°ν™”
      tabButtons.forEach(btn => {
        btn.classList.remove('text-purple-600', 'border-b-2', 'border-purple-600');
        btn.classList.add('text-gray-600');
      });
      
      // ν΄λ¦­ν• νƒ­ λ²„νΌ ν™μ„±ν™”
      this.classList.remove('text-gray-600');
      this.classList.add('text-purple-600', 'border-b-2', 'border-purple-600');
      
      // λ¨λ“  νƒ­ μ»¨ν…μΈ  μ¨κΈ°κΈ°
      tabContents.forEach(content => {
        content.classList.add('hidden');
      });
      
      // μ„ νƒν• νƒ­ μ»¨ν…μΈ  ν‘μ‹
      document.getElementById(targetTab + '-tab').classList.remove('hidden');
    });
  });
});

// ν—¬νΌ ν•¨μ
function achievement_category_name(category) {
  const names = {
    'participation': 'μ°Έκ°€',
    'host': 'νΈμ¤νΈ',
    'social': 'μ†μ…',
    'skill': 'μ‹¤λ ¥',
    'special': 'νΉλ³„'
  };
  return names[category] || category;
}
</script>