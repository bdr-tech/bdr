<div class="container mx-auto px-4 py-8">
  <div class="max-w-3xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">대회 등록하기</h1>
    
    <%= form_with model: @tournament, local: true, class: "space-y-6" do |f| %>
      <% if @tournament.errors.any? %>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
          <strong class="font-bold">다음 오류가 발생했습니다:</strong>
          <ul class="mt-2 list-disc list-inside">
            <% @tournament.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      
      <!-- 기본 정보 -->
      <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">기본 정보</h2>
        
        <div class="mb-4">
          <%= f.label :name, "대회명", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :name, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500", required: true %>
        </div>
        
        <div class="mb-4">
          <%= f.label :description, "대회 설명", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_area :description, rows: 4, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" %>
        </div>
        
        <div class="mb-4">
          <%= f.label :venue, "경기장", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :venue, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500", required: true %>
        </div>
        
        <div class="mb-4">
          <%= f.label :tournament_type, "대회 방식", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :tournament_type, 
              options_for_select([
                ['싱글 엘리미네이션', 'single_elimination'],
                ['더블 엘리미네이션', 'double_elimination'],
                ['라운드 로빈', 'round_robin'],
                ['그룹 스테이지', 'group_stage']
              ]), 
              { prompt: '대회 방식을 선택하세요' },
              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500", 
              required: true %>
        </div>
      </div>
      
      <!-- 참가 정보 -->
      <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">참가 정보</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <%= f.label :max_teams, "최대 팀 수", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.number_field :max_teams, min: 2, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500", required: true %>
          </div>
          
          <div>
            <%= f.label :entry_fee, "참가비 (원)", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.number_field :entry_fee, min: 0, step: 1000, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" %>
          </div>
        </div>
        
        <div class="mt-4">
          <%= f.label :prize_info, "상금 정보", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_area :prize_info, rows: 3, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" %>
        </div>
      </div>
      
      <!-- 일정 정보 -->
      <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">일정 정보</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <%= f.label :registration_start_at, "신청 시작일", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.datetime_local_field :registration_start_at, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500", required: true %>
          </div>
          
          <div>
            <%= f.label :registration_end_at, "신청 마감일", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.datetime_local_field :registration_end_at, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500", required: true %>
          </div>
          
          <div>
            <%= f.label :tournament_start_at, "대회 시작일", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.datetime_local_field :tournament_start_at, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500", required: true %>
          </div>
          
          <div>
            <%= f.label :tournament_end_at, "대회 종료일", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.datetime_local_field :tournament_end_at, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500", required: true %>
          </div>
        </div>
      </div>
      
      <!-- 대회 이미지 -->
      <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">대회 이미지</h2>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            이미지 업로드 (최대 5장)
          </label>
          
          <div class="space-y-4">
            <!-- 파일 선택 영역 -->
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors">
              <%= f.file_field :images, 
                  multiple: true, 
                  accept: "image/*",
                  class: "hidden",
                  id: "tournament-images",
                  data: { 
                    action: "change->image-upload#handleFileSelect",
                    target: "image-upload.input"
                  } %>
              
              <label for="tournament-images" class="cursor-pointer">
                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                  <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <p class="mt-2 text-sm text-gray-600">
                  <span class="font-medium text-blue-600 hover:underline">클릭하여 이미지 선택</span>
                  또는 드래그 앤 드롭
                </p>
                <p class="text-xs text-gray-500 mt-1">
                  JPG, PNG, GIF (최대 10MB)
                </p>
              </label>
            </div>
            
            <!-- 미리보기 영역 -->
            <div id="image-preview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4" data-target="image-upload.preview">
              <!-- 이미지 미리보기가 여기에 표시됩니다 -->
            </div>
          </div>
          
          <p class="mt-2 text-sm text-gray-500">
            * 첫 번째 이미지가 대표 이미지로 사용됩니다.
          </p>
        </div>
      </div>
      
      <!-- 추가 정보 -->
      <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">추가 정보</h2>
        
        <div class="mb-4">
          <%= f.label :rules, "대회 규칙", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_area :rules, rows: 5, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" %>
        </div>
        
        <div class="mb-4">
          <%= f.label :contact_info, "연락처 정보", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_area :contact_info, rows: 2, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" %>
        </div>
        
        <div class="mb-4">
          <%= f.label :is_featured, class: "inline-flex items-center" do %>
            <%= f.check_box :is_featured, class: "mr-2" %>
            추천 대회로 설정
          <% end %>
        </div>
      </div>
      
      <!-- 버튼 -->
      <div class="flex justify-end space-x-4">
        <%= link_to "취소", tournaments_path, class: "px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50" %>
        <%= f.submit "대회 등록", class: "px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer" %>
      </div>
    <% end %>
  </div>
</div>

<script>
<%= File.read(Rails.root.join('app/javascript/image_upload.js')).html_safe %>
</script>