<% content_for :title, "#{@game.court&.name || @game.venue_name || @game.title} Í≤ΩÍ∏∞ ÏÉÅÏÑ∏ - BDR" %>

<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4">
    <!-- Îí§Î°ú Í∞ÄÍ∏∞ -->
    <div class="mb-6">
      <%= link_to "‚Üê Í≤ΩÍ∏∞ Î™©Î°ùÏúºÎ°ú", games_path, class: "text-orange-600 hover:text-orange-800 transition duration-300" %>
    </div>

    <!-- Í≤ΩÍ∏∞ Ìó§Îçî -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <div class="flex flex-col md:flex-row md:items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-800 mb-2">üèÄ <%= @game.court&.name || @game.venue_name || @game.title %></h1>
          <!-- Í≤åÏûÑ ID Ïà®ÍπÄ Ï≤òÎ¶¨
          <div class="text-sm text-gray-600 mb-3 font-mono bg-gray-100 inline-block px-2 py-1 rounded">
            Í≤åÏûÑ ID: <%= @game.game_id %>
          </div>
          -->
          <div class="flex items-center gap-3 mb-4">
            <% if @game.can_accept_players? %>
              <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">Ï∞∏Í∞Ä Í∞ÄÎä•</span>
            <% else %>
              <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-semibold">Ï†ïÏõê ÎßàÍ∞ê</span>
            <% end %>
            
            <% if @game.scheduled_at.to_date == Date.current %>
              <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">Ïò§Îäò</span>
            <% elsif @game.scheduled_at.to_date == Date.tomorrow %>
              <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-semibold">ÎÇ¥Ïùº</span>
            <% end %>
          </div>
        </div>
        
        <div class="text-right">
          <div class="text-2xl font-bold text-orange-600 mb-1">
            <%= @game.confirmed_players_count %>/<%= @game.max_players %>Î™Ö
          </div>
          <div class="text-sm text-gray-600">
            <%= pluralize(@game.available_spots, 'ÏûêÎ¶¨') %> ÎÇ®Ïùå
          </div>
        </div>
      </div>
    </div>

    <!-- Ïã†Ï≤≠Ïûê Í¥ÄÎ¶¨ (Ìò∏Ïä§Ìä∏ Ï†ÑÏö©) -->
    <% if logged_in? && @game.organizer == current_user %>
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h3 class="text-xl font-bold text-gray-800 mb-6">üìã Ïã†Ï≤≠Ïûê Í¥ÄÎ¶¨</h3>
        
        <% 
          pending_apps = @game.game_applications.pending.includes(:user)
          waiting_payment_apps = @game.game_applications.waiting_payment.includes(:user, :payment)
          final_approved_apps = @game.game_applications.final_approved.includes(:user)
        %>
        
        <!-- ÏàòÏùµ ÏöîÏïΩ -->
        <% if @game.fee && @game.fee > 0 %>
          <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <span class="text-green-600 text-xl mr-2">üí∞</span>
                <span class="text-green-800 font-semibold">Ìò∏Ïä§Ìä∏ ÏàòÏùµ</span>
              </div>
              <div class="text-right">
                <div class="text-lg font-bold text-green-700">
                  <%= final_approved_apps.count %>Î™Ö √ó <%= number_to_currency(@game.fee, unit: '', precision: 0) %>Ïõê = 
                  <span class="text-green-800"><%= number_to_currency(@game.expected_host_revenue, unit: '', precision: 0) %>Ïõê</span>
                </div>
                <div class="text-sm text-green-600">
                  <% if @game.current_platform_fee_percentage > 0 %>
                    (ÌîåÎû´Ìèº ÏàòÏàòÎ£å <%= @game.current_platform_fee_percentage.to_i %>% Ï†úÏô∏)
                  <% end %>
                </div>
                <% if @game.payment_completion_rate < 100 %>
                  <div class="text-sm text-orange-600 mt-1">
                    Í≤∞Ï†ú ÏôÑÎ£å: <%= @game.payment_completion_rate %>% 
                    (Ïã§Ï†ú ÏàòÏùµ: <%= number_to_currency(@game.actual_host_revenue, unit: '', precision: 0) %>Ïõê)
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
        
        <!-- 1Îã®Í≥Ñ: ÏäπÏù∏ ÎåÄÍ∏∞ Ïã†Ï≤≠Ïûê -->
        <% if pending_apps.any? %>
          <div class="mb-8">
            <h4 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
              <span class="w-6 h-6 bg-yellow-500 text-white rounded-full flex items-center justify-center text-sm mr-2">1</span>
              ÏäπÏù∏ ÎåÄÍ∏∞ (<%= pending_apps.count %>Î™Ö)
            </h4>
            <div class="space-y-4">
              <% pending_apps.each do |application| %>
                <div class="border border-yellow-200 bg-yellow-50 rounded-lg p-4 flex items-center justify-between">
                  <div class="flex items-start">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white font-bold mr-4">
                      <%= application.user.nickname&.first&.upcase || application.user.name&.first&.upcase || 'U' %>
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center mb-2">
                        <div class="font-semibold text-gray-800 text-lg mr-3">
                          <%= application.user.nickname || application.user.name %>
                          <% if application.user.real_name.present? && application.user.real_name != (application.user.nickname || application.user.name) %>
                            <span class="text-sm text-gray-500 font-normal">(<%= application.user.real_name %>)</span>
                          <% end %>
                        </div>
                        <div class="text-sm text-gray-500">
                          <%= application.applied_at.strftime("%m/%d %H:%M") %>Ïóê Ïã†Ï≤≠
                        </div>
                      </div>
                      
                      <!-- ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Í∑∏Î¶¨Îìú -->
                      <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs text-gray-600 mb-2">
                        <div class="flex items-center">
                          <span class="text-blue-500 mr-1">üë§</span>
                          <span><%= application.user.age ? "#{application.user.age}ÏÑ∏" : "ÎÇòÏù¥ ÎØ∏ÏÑ§Ï†ï" %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-green-500 mr-1">üèÄ</span>
                          <span><%= application.user.position_names.first || "Ìè¨ÏßÄÏÖò ÎØ∏ÏÑ§Ï†ï" %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-purple-500 mr-1">‚≠ê</span>
                          <span><%= application.user.basketball_experience_text %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-orange-500 mr-1">üìä</span>
                          <span>Lv.<%= application.user.skill_level || "ÎØ∏Ï†ï" %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-yellow-500 mr-1">‚òÖ</span>
                          <span>ÌèâÏ†ê <%= application.user.evaluation_rating_percentage %>%</span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-gray-500 mr-1">üìû</span>
                          <span><%= application.user.phone.present? ? application.user.phone.gsub(/(\d{3})(\d{4})(\d{4})/, '\1-\2-\3') : "Î≤àÌò∏ ÎØ∏ÏÑ§Ï†ï" %></span>
                        </div>
                      </div>
                      
                      <% if application.message.present? %>
                        <div class="bg-gray-50 rounded-lg p-2 mt-2">
                          <div class="text-xs text-gray-500 mb-1">Ïã†Ï≤≠ Î©îÏãúÏßÄ</div>
                          <div class="text-sm text-gray-700">
                            "<%= application.message %>"
                          </div>
                        </div>
                      <% end %>
                    </div>
                  </div>
                  <div class="flex space-x-2">
                    <button onclick="approveApplication('<%= approve_application_game_path(@game, application_id: application.id) %>')" 
                            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300">
                      ÏäπÏù∏
                    </button>
                    <button onclick="rejectApplication('<%= reject_application_game_path(@game, application_id: application.id) %>')" 
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300">
                      Í±∞Ï†à
                    </button>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
        
        <!-- 2Îã®Í≥Ñ: ÏûÖÍ∏à ÎåÄÍ∏∞ Ïã†Ï≤≠Ïûê -->
        <% if waiting_payment_apps.any? %>
          <div class="mb-8">
            <h4 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
              <span class="w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm mr-2">2</span>
              ÏûÖÍ∏à ÎåÄÍ∏∞ (<%= waiting_payment_apps.count %>Î™Ö)
            </h4>
            <div class="space-y-4">
              <% waiting_payment_apps.each do |application| %>
                <div class="border border-orange-200 bg-orange-50 rounded-lg p-4 flex items-center justify-between">
                  <div class="flex items-start">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white font-bold mr-4">
                      <%= application.user.nickname&.first&.upcase || application.user.name&.first&.upcase || 'U' %>
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center mb-2">
                        <div class="font-semibold text-gray-800 text-lg mr-3">
                          <%= application.user.nickname || application.user.name %>
                          <% if application.user.real_name.present? && application.user.real_name != (application.user.nickname || application.user.name) %>
                            <span class="text-sm text-gray-500 font-normal">(<%= application.user.real_name %>)</span>
                          <% end %>
                        </div>
                        <div class="text-sm text-gray-500">
                          <%= application.approved_at.strftime("%m/%d %H:%M") %>Ïóê ÏäπÏù∏Îê®
                        </div>
                      </div>
                      
                      <div class="mb-2">
                        <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-semibold">
                          ÏûÖÍ∏à ÎåÄÍ∏∞Ï§ë (<%= number_to_currency(application.game.fee, unit: '‚Ç©', precision: 0) %>)
                        </span>
                      </div>
                      
                      <!-- ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Í∑∏Î¶¨Îìú -->
                      <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs text-gray-600 mb-2">
                        <div class="flex items-center">
                          <span class="text-blue-500 mr-1">üë§</span>
                          <span><%= application.user.age ? "#{application.user.age}ÏÑ∏" : "ÎÇòÏù¥ ÎØ∏ÏÑ§Ï†ï" %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-green-500 mr-1">üèÄ</span>
                          <span><%= application.user.position_names.first || "Ìè¨ÏßÄÏÖò ÎØ∏ÏÑ§Ï†ï" %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-purple-500 mr-1">‚≠ê</span>
                          <span><%= application.user.basketball_experience_text %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-orange-500 mr-1">üìä</span>
                          <span>Lv.<%= application.user.skill_level || "ÎØ∏Ï†ï" %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-yellow-500 mr-1">‚òÖ</span>
                          <span>ÌèâÏ†ê <%= application.user.evaluation_rating_percentage %>%</span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-gray-500 mr-1">üìû</span>
                          <span><%= application.user.phone.present? ? application.user.phone.gsub(/(\d{3})(\d{4})(\d{4})/, '\1-\2-\3') : "Î≤àÌò∏ ÎØ∏ÏÑ§Ï†ï" %></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="flex space-x-2">
                    <button onclick="confirmPayment('<%= confirm_payment_game_path(@game, application_id: application.id) %>')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300">
                      ÏûÖÍ∏à ÌôïÏù∏
                    </button>
                    <button onclick="rejectApplication('<%= reject_application_game_path(@game, application_id: application.id) %>')" 
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300">
                      Í±∞Ï†à
                    </button>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
        
        <!-- 3Îã®Í≥Ñ: ÏµúÏ¢Ö ÏäπÏù∏Îêú Ï∞∏Í∞ÄÏûê -->
        <% if final_approved_apps.any? %>
          <div class="mb-8">
            <h4 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
              <span class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm mr-2">‚úì</span>
              ÏµúÏ¢Ö ÏäπÏù∏ (<%= final_approved_apps.count %>Î™Ö)
            </h4>
            <div class="space-y-4">
              <% final_approved_apps.each do |application| %>
                <div class="border border-green-200 bg-green-50 rounded-lg p-4 flex items-center justify-between">
                  <div class="flex items-start">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center text-white font-bold mr-4">
                      <%= application.user.nickname&.first&.upcase || application.user.name&.first&.upcase || 'U' %>
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center mb-2">
                        <div class="font-semibold text-gray-800 text-lg mr-3">
                          <%= application.user.nickname || application.user.name %>
                          <% if application.user.real_name.present? && application.user.real_name != (application.user.nickname || application.user.name) %>
                            <span class="text-sm text-gray-500 font-normal">(<%= application.user.real_name %>)</span>
                          <% end %>
                        </div>
                        <div class="text-sm text-gray-500">
                          <%= application.final_approved_at.strftime("%m/%d %H:%M") %>Ïóê ÏµúÏ¢Ö ÏäπÏù∏Îê®
                        </div>
                      </div>
                      
                      <div class="mb-2">
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold">
                          Ï∞∏Í∞Ä ÌôïÏ†ï
                        </span>
                      </div>
                      
                      <!-- ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Í∑∏Î¶¨Îìú -->
                      <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs text-gray-600 mb-2">
                        <div class="flex items-center">
                          <span class="text-blue-500 mr-1">üë§</span>
                          <span><%= application.user.age ? "#{application.user.age}ÏÑ∏" : "ÎÇòÏù¥ ÎØ∏ÏÑ§Ï†ï" %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-green-500 mr-1">üèÄ</span>
                          <span><%= application.user.position_names.first || "Ìè¨ÏßÄÏÖò ÎØ∏ÏÑ§Ï†ï" %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-purple-500 mr-1">‚≠ê</span>
                          <span><%= application.user.basketball_experience_text %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-orange-500 mr-1">üìä</span>
                          <span>Lv.<%= application.user.skill_level || "ÎØ∏Ï†ï" %></span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-yellow-500 mr-1">‚òÖ</span>
                          <span>ÌèâÏ†ê <%= application.user.evaluation_rating_percentage %>%</span>
                        </div>
                        <div class="flex items-center">
                          <span class="text-gray-500 mr-1">üìû</span>
                          <span><%= application.user.phone.present? ? application.user.phone.gsub(/(\d{3})(\d{4})(\d{4})/, '\1-\2-\3') : "Î≤àÌò∏ ÎØ∏ÏÑ§Ï†ï" %></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="flex items-center">
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                      ÏäπÏù∏ ÏôÑÎ£å
                    </span>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
        
        <!-- Ïã†Ï≤≠ÏûêÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞ -->
        <% if pending_apps.empty? && waiting_payment_apps.empty? && final_approved_apps.empty? %>
          <div class="text-center text-gray-500 py-8">
            <div class="text-6xl mb-4">üì≠</div>
            <div class="text-lg">ÏïÑÏßÅ Ïã†Ï≤≠ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§</div>
            <div class="text-sm mt-2">Í≤ΩÍ∏∞Í∞Ä ÏÉùÏÑ±ÎêòÎ©¥ Ïã†Ï≤≠ÏûêÎì§Ïù¥ ÎÇòÌÉÄÎÇ† Í±∞ÏòàÏöî!</div>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Í≤ΩÍ∏∞ Ï†ïÎ≥¥ -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
      <!-- Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
      <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">üìã Í≤ΩÍ∏∞ Ï†ïÎ≥¥</h2>
        
        <div class="space-y-4">
          <div class="flex items-center">
            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
              <span class="text-blue-600">üìÖ</span>
            </div>
            <div>
              <div class="font-semibold text-gray-800">Í≤ΩÍ∏∞ ÎÇ†Ïßú</div>
              <div class="text-gray-600"><%= @game.scheduled_at.strftime("%YÎÖÑ %mÏõî %dÏùº (%a)") %></div>
            </div>
          </div>
          
          <div class="flex items-center">
            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3">
              <span class="text-green-600">‚è∞</span>
            </div>
            <div>
              <div class="font-semibold text-gray-800">Í≤ΩÍ∏∞ ÏãúÍ∞Ñ</div>
              <div class="text-gray-600">
                <%= @game.start_time&.strftime("%H:%M") || @game.scheduled_at.strftime("%H:%M") %> ~ <%= @game.end_time&.strftime("%H:%M") || (@game.scheduled_at + 2.hours).strftime("%H:%M") %>
                <% if @game.start_time && @game.end_time %>
                  <% duration_hours = ((@game.end_time - @game.start_time) / 1.hour).round(1) %>
                  (<%= duration_hours == duration_hours.to_i ? duration_hours.to_i : duration_hours %>ÏãúÍ∞Ñ)
                <% else %>
                  (2ÏãúÍ∞Ñ)
                <% end %>
              </div>
            </div>
          </div>
          
          <div class="flex items-center">
            <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center mr-3">
              <span class="text-orange-600">üìç</span>
            </div>
            <div>
              <div class="font-semibold text-gray-800">Í≤ΩÍ∏∞ Ïû•ÏÜå</div>
              <div class="text-gray-600"><%= @game.court&.address || @game.venue_address || 'Ïû•ÏÜå Ï†ïÎ≥¥ ÏóÜÏùå' %></div>
            </div>
          </div>
          
          <div class="flex items-center">
            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-3">
              <span class="text-purple-600">üèüÔ∏è</span>
            </div>
            <div>
              <div class="font-semibold text-gray-800">ÏΩîÌä∏ Ïú†Ìòï</div>
              <div class="text-gray-600"><%= @game.court&.court_type == 'indoor' ? 'Ïã§ÎÇ¥ ÏΩîÌä∏' : (@game.court&.court_type == 'outdoor' ? 'Ïã§Ïô∏ ÏΩîÌä∏' : 'Ïú†Ìòï ÎØ∏Ï†ï') %></div>
            </div>
          </div>
          
          <div class="flex items-center">
            <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center mr-3">
              <span class="text-red-600">üë•</span>
            </div>
            <div>
              <div class="font-semibold text-gray-800">Î™®Ïßë Ïù∏Ïõê</div>
              <div class="text-gray-600">ÏµúÎåÄ <%= @game.max_players %>Î™Ö</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ï£ºÏµúÏûê Ï†ïÎ≥¥ -->
      <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">üë§ Ï£ºÏµúÏûê Ï†ïÎ≥¥</h2>
        
        <% if @game.organizer %>
          <div class="flex items-center mb-4">
            <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white text-lg font-bold mr-4">
              <%= @game.organizer.name.first %>
            </div>
            <div>
              <div class="font-semibold text-gray-800"><%= @game.organizer.nickname || @game.organizer.name %></div>
              <div class="text-sm text-gray-600">Í≤ΩÍ∏∞ Ï£ºÏµúÏûê</div>
            </div>
          </div>
          
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-gray-600">Ïã§Î†• ÏàòÏ§Ä</span>
              <div class="flex items-center">
                <span class="text-gray-800 font-semibold"><%= @game.organizer.skill_level_name %></span>
                <span class="ml-2 text-sm text-gray-600">(Lv.<%= @game.organizer.skill_level || 3 %>)</span>
              </div>
            </div>
            
            <div class="flex justify-between">
              <span class="text-gray-600">ÌèâÏ†ê</span>
              <div class="flex items-center">
                <span class="text-yellow-500 mr-1">‚òÖ</span>
                <span class="text-gray-800 font-semibold"><%= @game.organizer.evaluation_rating_percentage %>%</span>
                <span class="ml-2 text-sm text-gray-600">(<%= @game.organizer.rating_count %>Í∞ú ÌèâÍ∞Ä)</span>
              </div>
            </div>
            
            <% if @game.organizer.position_names.any? %>
              <div class="flex justify-between">
                <span class="text-gray-600">ÏÑ†Ìò∏ Ìè¨ÏßÄÏÖò</span>
                <div class="flex gap-1">
                  <% @game.organizer.position_names.each do |position| %>
                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs"><%= position %></span>
                  <% end %>
                </div>
              </div>
            <% end %>
            
            <% if @game.organizer.location_full_name.present? %>
              <div class="flex justify-between">
                <span class="text-gray-600">ÌôúÎèô ÏßÄÏó≠</span>
                <span class="text-gray-800"><%= @game.organizer.location_full_name %></span>
              </div>
            <% end %>
            
            <% if @game.organizer.team_name.present? %>
              <div class="flex justify-between">
                <span class="text-gray-600">ÏÜåÏÜç ÌåÄ</span>
                <span class="text-gray-800"><%= @game.organizer.team_name %></span>
              </div>
            <% end %>
          </div>
          
          <% if @game.organizer.bio.present? %>
            <div class="mt-4 p-3 bg-gray-50 rounded-lg">
              <div class="text-sm text-gray-600 mb-1">ÏÜåÍ∞ú</div>
              <div class="text-gray-800 text-sm"><%= @game.organizer.bio %></div>
            </div>
          <% end %>
        <% else %>
          <div class="text-center py-8">
            <div class="text-gray-500">Ï£ºÏµúÏûê Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Ï∞∏Í∞ÄÏûê Î™©Î°ù -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">üë• Ï∞∏Í∞ÄÏûê Î™©Î°ù</h2>
      
      <% if @game.confirmed_players.any? %>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <% @game.confirmed_players.each do |player| %>
            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-bold mr-3">
                <%= player.name.first %>
              </div>
              <div>
                <div class="font-semibold text-gray-800"><%= player.nickname || player.name %></div>
                <div class="text-sm text-gray-600">
                  <% if player.position_names.any? %>
                    <%= player.position_names.join(', ') %>
                  <% else %>
                    <%= player.old_position || 'N/A' %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <div class="text-gray-500">ÏïÑÏßÅ Ï∞∏Í∞ÄÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>
          <div class="text-sm text-gray-400 mt-1">Ï≤´ Î≤àÏß∏ Ï∞∏Í∞ÄÏûêÍ∞Ä ÎêòÏñ¥Î≥¥ÏÑ∏Ïöî!</div>
        </div>
      <% end %>
    </div>

    <!-- ÏΩîÌä∏ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ -->
    <% if @game.court.present? %>
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">üèüÔ∏è ÏΩîÌä∏ Ï†ïÎ≥¥</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-gray-600">ÏΩîÌä∏Î™Ö</span>
              <span class="text-gray-800 font-semibold"><%= @game.court.name %></span>
            </div>
            
            <div class="flex justify-between">
              <span class="text-gray-600">Ï£ºÏÜå</span>
              <span class="text-gray-800"><%= @game.court.address %></span>
            </div>
            
            <div class="flex justify-between">
              <span class="text-gray-600">ÏΩîÌä∏ Ïú†Ìòï</span>
              <span class="text-gray-800">
                <span class="bg-<%= @game.court.court_type == 'indoor' ? 'blue' : 'green' %>-100 text-<%= @game.court.court_type == 'indoor' ? 'blue' : 'green' %>-800 px-2 py-1 rounded text-sm">
                  <%= @game.court.court_type == 'indoor' ? 'Ïã§ÎÇ¥' : 'Ïã§Ïô∏' %>
                </span>
              </span>
            </div>
            
            <div class="flex justify-between">
              <span class="text-gray-600">ÏàòÏö© Ïù∏Ïõê</span>
              <span class="text-gray-800">ÏµúÎåÄ <%= @game.court.capacity %>Î™Ö</span>
            </div>
          </div>
          
          <!-- ÏãúÏÑ§ Ï†ïÎ≥¥ -->
          <div class="space-y-3">
            <h3 class="font-semibold text-gray-800 mb-3">üè¢ ÏãúÏÑ§ Ï†ïÎ≥¥</h3>
            
            <div class="grid grid-cols-2 gap-2 text-sm">
              <div class="flex items-center">
                <span class="<%= @game.court.water_fountain? ? 'text-green-600' : 'text-red-600' %> mr-2">
                  <%= @game.court.water_fountain? ? '‚úÖ' : '‚ùå' %>
                </span>
                <span class="text-gray-600">Ï†ïÏàòÍ∏∞</span>
              </div>
              
              <div class="flex items-center">
                <span class="<%= @game.court.shower_available? ? 'text-green-600' : 'text-red-600' %> mr-2">
                  <%= @game.court.shower_available? ? '‚úÖ' : '‚ùå' %>
                </span>
                <span class="text-gray-600">ÏÉ§ÏõåÏã§</span>
              </div>
              
              <div class="flex items-center">
                <span class="<%= @game.court.parking_available? ? 'text-green-600' : 'text-red-600' %> mr-2">
                  <%= @game.court.parking_available? ? '‚úÖ' : '‚ùå' %>
                </span>
                <span class="text-gray-600">Ï£ºÏ∞®Ïû•</span>
              </div>
              
              <div class="flex items-center">
                <span class="<%= @game.court.locker_room? ? 'text-green-600' : 'text-red-600' %> mr-2">
                  <%= @game.court.locker_room? ? '‚úÖ' : '‚ùå' %>
                </span>
                <span class="text-gray-600">ÎùºÏª§Î£∏</span>
              </div>
              
              <div class="flex items-center">
                <span class="<%= @game.court.air_conditioning? ? 'text-green-600' : 'text-red-600' %> mr-2">
                  <%= @game.court.air_conditioning? ? '‚úÖ' : '‚ùå' %>
                </span>
                <span class="text-gray-600">ÏóêÏñ¥Ïª®</span>
              </div>
              
              <div class="flex items-center">
                <span class="<%= @game.court.equipment_rental? ? 'text-green-600' : 'text-red-600' %> mr-2">
                  <%= @game.court.equipment_rental? ? '‚úÖ' : '‚ùå' %>
                </span>
                <span class="text-gray-600">Ïû•ÎπÑÎåÄÏó¨</span>
              </div>
              
              <div class="flex items-center">
                <span class="<%= @game.court.smoking_allowed? ? 'text-yellow-600' : 'text-green-600' %> mr-2">
                  <%= @game.court.smoking_allowed? ? '‚ö†Ô∏è' : 'üö≠' %>
                </span>
                <span class="text-gray-600">Ìù°Ïó∞ <%= @game.court.smoking_allowed? ? 'ÌóàÏö©' : 'Í∏àÏßÄ' %></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <!-- Í≤åÏûÑÏóê ÏΩîÌä∏Í∞Ä ÏóÜÏùÑ Í≤ΩÏö∞ Ïû•ÏÜå Ï†ïÎ≥¥Îßå ÌëúÏãú -->
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">üèüÔ∏è Ïû•ÏÜå Ï†ïÎ≥¥</h2>
        
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="text-gray-600">Ïû•ÏÜåÎ™Ö</span>
            <span class="text-gray-800 font-semibold"><%= @game.venue_name || 'Ïû•ÏÜå Ï†ïÎ≥¥ ÏóÜÏùå' %></span>
          </div>
          
          <div class="flex justify-between">
            <span class="text-gray-600">Ï£ºÏÜå</span>
            <span class="text-gray-800"><%= @game.venue_address || 'Ï£ºÏÜå Ï†ïÎ≥¥ ÏóÜÏùå' %></span>
          </div>
          
          <div class="flex justify-between">
            <span class="text-gray-600">Î™®Ïßë Ïù∏Ïõê</span>
            <span class="text-gray-800">ÏµúÎåÄ <%= @game.max_players %>Î™Ö</span>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Ïú†ÎãàÌèº ÏÉâÏÉÅ Ï†ïÎ≥¥ -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">üëï Ï§ÄÎπÑÌï¥Ïïº Ìï† Ïú†ÎãàÌèº</h2>
      
      <% if @game.uniform_colors.present? && @game.uniform_colors.any? %>
        <div class="grid grid-cols-<%= @game.uniform_colors.length %> gap-4 justify-center">
          <% @game.uniform_colors.each_with_index do |color, index| %>
            <div class="text-center">
              <div class="bg-gray-50 rounded-lg p-4">
                <div class="text-lg font-semibold text-gray-800 mb-2">
                  <%= index == 0 ? "1ÏàúÏúÑ" : "2ÏàúÏúÑ" %>
                </div>
                <div class="w-16 h-16 mx-auto rounded-full border-4 border-gray-300 flex items-center justify-center mb-2" 
                     style="background-color: <%= get_uniform_color_code(color) %>; <%= color == 'white' ? 'border-color: #D1D5DB;' : '' %>">
                  <% if color == 'white' %>
                    <span class="text-gray-600 font-bold text-xs">Ïú†ÎãàÌèº</span>
                  <% elsif color == 'black' %>
                    <span class="text-white font-bold text-xs">Ïú†ÎãàÌèº</span>
                  <% else %>
                    <span class="text-white font-bold text-xs drop-shadow-md">Ïú†ÎãàÌèº</span>
                  <% end %>
                </div>
                <div class="text-sm text-gray-600"><%= Game::UNIFORM_COLORS[color] %></div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <div class="text-gray-500">Ïú†ÎãàÌèº ÏÉâÏÉÅ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
        </div>
      <% end %>
      
      <div class="mt-4 p-3 bg-blue-50 rounded-lg">
        <div class="flex items-center">
          <span class="text-blue-600 mr-2">‚ÑπÔ∏è</span>
          <span class="text-sm text-blue-800">
            ÏúÑÏóê ÌëúÏãúÎêú ÏÉâÏÉÅÏùò Ïú†ÎãàÌèºÏùÑ Ï§ÄÎπÑÌï¥Ï£ºÏÑ∏Ïöî. ÌåÄ Î∞∞Ï†ïÏùÄ Í≤ΩÍ∏∞ ÏãúÏûë Ï†Ñ Ï£ºÏµúÏûêÍ∞Ä ÏßÑÌñâÌï©ÎãàÎã§.
          </span>
        </div>
      </div>
    </div>

    <!-- Ïã†Ï≤≠ÌïòÍ∏∞ Î≤ÑÌäº -->
    <div class="bg-white rounded-lg shadow-lg p-6">
      <% if logged_in? %>
        <% current_application = @game.game_applications.find_by(user: current_user) %>
        
        <% if current_application %>
          <!-- Ïù¥ÎØ∏ Ïã†Ï≤≠Ìïú Í≤ΩÏö∞ -->
          <div class="text-center">
            <% if current_application.pending? %>
              <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                <div class="text-yellow-800 font-semibold mb-2">‚è≥ ÏäπÏù∏ ÎåÄÍ∏∞Ï§ë</div>
                <div class="text-sm text-yellow-600">
                  Ï£ºÏµúÏûêÍ∞Ä Ïã†Ï≤≠ÏùÑ Í≤ÄÌÜ† Ï§ëÏûÖÎãàÎã§. Ï°∞Í∏àÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.
                </div>
              </div>
              <button onclick="cancelApplication('<%= cancel_application_game_path(@game) %>')" 
                      class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                Ïã†Ï≤≠ Ï∑®ÏÜå
              </button>
            <% elsif current_application.status == 'waiting_payment' %>
              <!-- ÏäπÏù∏Îê® - Í≤∞Ï†ú ÎåÄÍ∏∞ ÏÉÅÌÉú -->
              <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                <div class="text-orange-800 font-semibold mb-2">üí≥ Í≤∞Ï†ú ÌïÑÏöî</div>
                <div class="text-sm text-orange-600 mb-3">
                  Í≤ΩÍ∏∞ Ï∞∏Í∞ÄÍ∞Ä ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§! Ï∞∏Í∞ÄÎπÑÎ•º Í≤∞Ï†úÌï¥Ï£ºÏÑ∏Ïöî.
                </div>
                <div class="text-lg font-bold text-gray-800 mb-4">
                  Ï∞∏Í∞ÄÎπÑ: <%= @game.fee_display %>
                </div>
              </div>
              
              <!-- Í≤∞Ï†ú Î≤ÑÌäº -->
              <%= link_to "üí≥ Í≤∞Ï†úÌïòÍ∏∞", new_game_game_application_payment_path(@game, current_application), 
                          class: "w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-center block" %>
                          
            <% elsif current_application.status == 'final_approved' %>
              <!-- ÏµúÏ¢Ö ÏäπÏù∏Îê® -->
              <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                <div class="text-green-800 font-semibold mb-2">‚úÖ Ï∞∏Í∞Ä ÌôïÏ†ï</div>
                <div class="text-sm text-green-600">
                  Í≤∞Ï†úÍ∞Ä ÏôÑÎ£åÎêòÏñ¥ Í≤ΩÍ∏∞ Ï∞∏Í∞ÄÍ∞Ä ÌôïÏ†ïÎêòÏóàÏäµÎãàÎã§!
                </div>
              </div>
              
              <!-- ÌèâÍ∞Ä Î≤ÑÌäº (Í≤ΩÍ∏∞ Ï¢ÖÎ£å 30Î∂Ñ ÌõÑÎ∂ÄÌÑ∞ 24ÏãúÍ∞Ñ ÎèôÏïà) -->
              <% if @game.evaluation_available? %>
                <%= link_to "üåü ÎèôÎ£å ÌèâÍ∞ÄÌïòÍ∏∞", game_player_evaluations_path(@game), 
                            class: "w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-center block mb-2" %>
              <% end %>
              
              <!-- ÌèâÏ†ê Ï£ºÍ∏∞ Î≤ÑÌäº (Í≤ΩÍ∏∞ ÏôÑÎ£å ÌõÑ) -->
              <% if @game.status == 'completed' && !current_user.ratings.where(game: @game).exists? %>
                <%= link_to "‚≠ê ÌèâÏ†ê Ï£ºÍ∏∞", new_game_rating_path(@game), 
                            class: "w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-center block mb-2" %>
              <% end %>
              
              <!-- ÌèâÏ†ê Î≥¥Í∏∞ Î≤ÑÌäº -->
              <% if @game.status == 'completed' && @game.ratings.any? %>
                <%= link_to "üìä ÌèâÏ†ê Î≥¥Í∏∞", game_ratings_path(@game), 
                            class: "w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-center block mb-2" %>
              <% end %>
              
              <!-- ÌôòÎ∂à Î≤ÑÌäº (Í≤ΩÍ∏∞ ÏãúÏûë 24ÏãúÍ∞Ñ Ï†ÑÍπåÏßÄ) -->
              <% payment = current_application.payment %>
              <% if payment && ['completed', 'paid'].include?(payment.status) && @game.start_time > 24.hours.from_now %>
                <%= link_to "üí∏ ÌôòÎ∂à Ïã†Ï≤≠", new_payment_refund_path(payment), 
                            class: "w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-center block" %>
              <% end %>
            <% elsif current_application.rejected? %>
              <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <div class="text-red-800 font-semibold mb-2">‚ùå Í±∞Ï†àÎê®</div>
                <div class="text-sm text-red-600">
                  Ï£ÑÏÜ°Ìï©ÎãàÎã§. Ïù¥Î≤à Í≤ΩÍ∏∞ Ï∞∏Í∞ÄÍ∞Ä Í±∞Ï†àÎêòÏóàÏäµÎãàÎã§.
                </div>
              </div>
            <% end %>
          </div>
        <% elsif @game.organizer == current_user %>
          <!-- Ï£ºÏµúÏûêÏù∏ Í≤ΩÏö∞ -->
          <div class="text-center">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
              <div class="text-blue-800 font-semibold mb-2">üéØ Ï£ºÏµúÏûê</div>
              <div class="text-sm text-blue-600">
                Ïù¥ Í≤ΩÍ∏∞Ïùò Ï£ºÏµúÏûêÏûÖÎãàÎã§. Ïã†Ï≤≠ÏûêÎì§ÏùÑ ÌôïÏù∏ÌïòÍ≥† ÏäπÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.
              </div>
            </div>
            <div class="flex justify-center space-x-3">
              <%= link_to "‚úèÔ∏è Í≤ΩÍ∏∞ ÏàòÏ†ï", edit_game_path(@game), 
                          class: "bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300" %>
              <%= button_to "üìã Í≤ΩÍ∏∞ Î≥µÏÇ¨", duplicate_game_path(@game),
                          method: :post,
                          class: "bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300" %>
              <button onclick="confirmDeleteGame()" 
                      class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                üóëÔ∏è Í≤ΩÍ∏∞ ÏÇ≠Ï†ú
              </button>
            </div>
            
            <!-- Ìò∏Ïä§Ìä∏ÎèÑ ÌèâÍ∞Ä Í∞ÄÎä• -->
            <% if @game.evaluation_available? %>
              <div class="mt-4">
                <%= link_to "üåü ÎèôÎ£å ÌèâÍ∞ÄÌïòÍ∏∞", game_player_evaluations_path(@game), 
                            class: "w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-center block" %>
              </div>
            <% end %>
            
            <!-- ÌèâÏ†ê Ï£ºÍ∏∞ Î≤ÑÌäº (Í≤ΩÍ∏∞ ÏôÑÎ£å ÌõÑ) -->
            <% if @game.status == 'completed' && !current_user.ratings.where(game: @game).exists? %>
              <div class="mt-4">
                <%= link_to "‚≠ê ÌèâÏ†ê Ï£ºÍ∏∞", new_game_rating_path(@game), 
                            class: "w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-center block" %>
              </div>
            <% end %>
            
            <!-- ÌèâÏ†ê Î≥¥Í∏∞ Î≤ÑÌäº -->
            <% if @game.status == 'completed' && @game.ratings.any? %>
              <div class="mt-4">
                <%= link_to "üìä ÌèâÏ†ê Î≥¥Í∏∞", game_ratings_path(@game), 
                            class: "w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-center block" %>
              </div>
            <% end %>
          </div>
        <% elsif !current_user.can_apply_for_games? %>
          <!-- Ïã†Ï≤≠ Ï†úÌïú ÏÉÅÌÉú -->
          <div class="text-center">
            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
              <div class="text-red-800 font-semibold mb-2">üö´ Ïã†Ï≤≠ Ï†úÌïú</div>
              <div class="text-sm text-red-600">
                Ï∑®ÏÜå ÌöüÏàò Ï†úÌïúÏúºÎ°ú Ïù∏Ìï¥ <%= current_user.cancellation_hours_until_reset %>ÏãúÍ∞Ñ ÌõÑ Ïã†Ï≤≠Ïù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.
              </div>
            </div>
          </div>
        <% elsif !current_user.can_participate_in_games? %>
          <!-- ÌîÑÎ°úÌïÑ ÎØ∏ÏôÑÏÑ± -->
          <div class="text-center">
            <div class="mb-4">
              <div class="text-red-600 font-semibold mb-2">ÌîÑÎ°úÌïÑÏùÑ ÏôÑÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî</div>
              <div class="text-sm text-gray-600">
                Í≤ΩÍ∏∞ Ï∞∏Í∞ÄÎ•º ÏúÑÌï¥ÏÑúÎäî ÌîÑÎ°úÌïÑ ÏôÑÏÑ±Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§. (ÌòÑÏû¨ ÏôÑÏÑ±ÎèÑ: <%= current_user.profile_completion_percentage %>%)
              </div>
            </div>
            <%= link_to "ÌîÑÎ°úÌïÑ ÏôÑÏÑ±ÌïòÍ∏∞", profile_edit_path, class: "bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-lg text-lg transition duration-300" %>
          </div>
        <% elsif !@game.can_accept_players? %>
          <!-- Ï†ïÏõê ÎßàÍ∞ê -->
          <div class="text-center">
            <button disabled class="bg-gray-300 text-gray-500 font-bold py-4 px-8 rounded-lg text-lg cursor-not-allowed">
              Ï†ïÏõêÏù¥ ÎßàÍ∞êÎêòÏóàÏäµÎãàÎã§
            </button>
          </div>
        <% else %>
          <!-- Ïã†Ï≤≠ Í∞ÄÎä• -->
          <div class="text-center">
            <button onclick="showApplicationModal()" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-8 rounded-lg text-lg transition duration-300 transform hover:scale-105">
              üèÄ Ïù¥ Í≤ΩÍ∏∞Ïóê Ï∞∏Í∞Ä Ïã†Ï≤≠ÌïòÍ∏∞
            </button>
            <div class="mt-3 text-sm text-gray-600">
              Ïã†Ï≤≠ ÌõÑ Ï£ºÏµúÏûê ÏäπÏù∏ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="text-center">
          <div class="mb-4">
            <div class="text-gray-700 font-semibold mb-2">Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§</div>
            <div class="text-sm text-gray-600">
              Í≤ΩÍ∏∞ Ï∞∏Í∞Ä Ïã†Ï≤≠ÏùÑ ÏúÑÌï¥ Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî
            </div>
          </div>
          <%= link_to "Î°úÍ∑∏Ïù∏ÌïòÍ∏∞", login_path, class: "bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-8 rounded-lg text-lg transition duration-300" %>
        </div>
      <% end %>
    </div>
    
    <!-- ÎîîÎ≤ÑÍπÖ Ï†ïÎ≥¥ Ïà®ÍπÄ Ï≤òÎ¶¨
    <div class="bg-white rounded-lg shadow-lg p-6 mt-8">
      <h3 class="text-xl font-bold text-gray-800 mb-6">üîç ÎîîÎ≤ÑÍπÖ Ï†ïÎ≥¥</h3>
      <div class="bg-gray-100 p-4 rounded-lg text-sm">
        <p><strong>Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú:</strong> <%= logged_in? ? "Î°úÍ∑∏Ïù∏Îê®" : "Î°úÍ∑∏Ïù∏ ÏïàÎê®" %></p>
        <p><strong>ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê:</strong> <%= current_user&.nickname || current_user&.name || "ÏóÜÏùå" %> (ID: <%= current_user&.id || "ÏóÜÏùå" %>)</p>
        <p><strong>Í≤åÏûÑ Ï£ºÏµúÏûê:</strong> <%= @game.organizer.nickname || @game.organizer.name %> (ID: <%= @game.organizer.id %>)</p>
        <p><strong>Ï£ºÏµúÏûê ÏùºÏπò:</strong> <%= @game.organizer == current_user ? "ÏùºÏπò" : "Î∂àÏùºÏπò" %></p>
        <p><strong>ÎåÄÍ∏∞ Ïã†Ï≤≠Ïûê Ïàò:</strong> <%= @pending_applications.count %></p>
        <% if @pending_applications.any? %>
          <p><strong>Ïã†Ï≤≠Ïûê Î™©Î°ù:</strong></p>
          <ul class="ml-4">
            <% @pending_applications.each do |app| %>
              <li>- <%= app.user.nickname || app.user.name %> (ID: <%= app.user.id %>)</li>
            <% end %>
          </ul>
        <% end %>
      </div>
    </div>
    -->
    
  </div>
</div>

<!-- Ï∞∏Í∞Ä Ïã†Ï≤≠ Î™®Îã¨ -->
<div id="applicationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
    <h3 class="text-lg font-bold text-gray-800 mb-4">Í≤ΩÍ∏∞ Ï∞∏Í∞Ä Ïã†Ï≤≠</h3>
    
    <%= form_with url: apply_game_path(@game), local: true, class: "space-y-4" do |form| %>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Ïã†Ï≤≠ Î©îÏãúÏßÄ (ÏÑ†ÌÉù)</label>
        <%= form.text_area :message, rows: 3,
              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
              placeholder: "Ï£ºÏµúÏûêÏóêÍ≤å Ï†ÑÎã¨Ìï† Î©îÏãúÏßÄÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî" %>
      </div>
      
      <div class="flex justify-end space-x-3">
        <button type="button" onclick="hideApplicationModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
          Ï∑®ÏÜå
        </button>
        <%= form.submit "Ïã†Ï≤≠ÌïòÍ∏∞", class: "px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-md" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Í≤ΩÍ∏∞ ÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨ -->
<div id="deleteGameModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
    <div class="text-center">
      <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
        <span class="text-red-600 text-2xl">‚ö†Ô∏è</span>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Í≤ΩÍ∏∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</h3>
      <p class="text-sm text-gray-600 mb-6">
        Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.<br>
        <% if @game.confirmed_players_count > 0 %>
          <span class="text-red-600 font-semibold">ÌòÑÏû¨ <%= @game.confirmed_players_count %>Î™ÖÏùò Ï∞∏Í∞ÄÏûêÍ∞Ä ÏûàÏäµÎãàÎã§.</span><br>
        <% end %>
        ÏÇ≠Ï†ú Ïãú Î™®Îì† Ï∞∏Í∞Ä Ïã†Ï≤≠ Ï†ïÎ≥¥Í∞Ä Ìï®Íªò ÏÇ≠Ï†úÎê©ÎãàÎã§.
      </p>
    </div>
    
    <div class="flex justify-center space-x-3">
      <button type="button" onclick="hideDeleteGameModal()" 
              class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
        Ï∑®ÏÜå
      </button>
      <%= button_to "ÏÇ≠Ï†ú", game_path(@game), 
                    method: :delete,
                    class: "px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md" %>
    </div>
  </div>
</div>

<script>
function showApplicationModal() {
  document.getElementById('applicationModal').classList.remove('hidden');
  document.getElementById('applicationModal').classList.add('flex');
}

function hideApplicationModal() {
  document.getElementById('applicationModal').classList.add('hidden');
  document.getElementById('applicationModal').classList.remove('flex');
}

function confirmDeleteGame() {
  document.getElementById('deleteGameModal').classList.remove('hidden');
  document.getElementById('deleteGameModal').classList.add('flex');
}

function hideDeleteGameModal() {
  document.getElementById('deleteGameModal').classList.add('hidden');
  document.getElementById('deleteGameModal').classList.remove('flex');
}

// Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
document.getElementById('applicationModal').addEventListener('click', function(e) {
  if (e.target === this) {
    hideApplicationModal();
  }
});

document.getElementById('deleteGameModal').addEventListener('click', function(e) {
  if (e.target === this) {
    hideDeleteGameModal();
  }
});

// Ïã†Ï≤≠ Ï∑®ÏÜå Ìï®Ïàò
function cancelApplication(url) {
  if (confirm('Ï†ïÎßêÎ°ú Ïã†Ï≤≠ÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
    fetch(url, {
      method: 'DELETE',
      headers: {
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        window.location.reload();
      } else {
        alert('Ïã†Ï≤≠ Ï∑®ÏÜåÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Ïã†Ï≤≠ Ï∑®ÏÜåÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    });
  }
}

// Ïã†Ï≤≠ ÏäπÏù∏ Ìï®Ïàò
function approveApplication(url) {
  if (confirm('Ïù¥ Ïã†Ï≤≠ÏùÑ ÏäπÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
    fetch(url, {
      method: 'POST',
      headers: {
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        window.location.reload();
      } else {
        alert('Ïã†Ï≤≠ ÏäπÏù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Ïã†Ï≤≠ ÏäπÏù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    });
  }
}

// Ïã†Ï≤≠ Í±∞Ï†à Ìï®Ïàò
function rejectApplication(url) {
  if (confirm('Ïù¥ Ïã†Ï≤≠ÏùÑ Í±∞Ï†àÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
    fetch(url, {
      method: 'POST',
      headers: {
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        window.location.reload();
      } else {
        alert('Ïã†Ï≤≠ Í±∞Ï†àÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Ïã†Ï≤≠ Í±∞Ï†àÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    });
  }
}

// ÏûÖÍ∏à ÌôïÏù∏ Ìï®Ïàò
function confirmPayment(url) {
  if (confirm('ÏûÖÍ∏àÏùÑ ÌôïÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå? ÌôïÏù∏ ÌõÑ Ìï¥Îãπ Ïã†Ï≤≠ÏûêÎäî ÏµúÏ¢Ö ÏäπÏù∏ÎêòÎ©∞ Í≤ΩÍ∏∞ Ï∞∏Í∞ÄÍ∞Ä ÌôïÏ†ïÎê©ÎãàÎã§.')) {
    fetch(url, {
      method: 'POST',
      headers: {
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        window.location.reload();
      } else {
        alert('ÏûÖÍ∏à ÌôïÏù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('ÏûÖÍ∏à ÌôïÏù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    });
  }
}
</script>
