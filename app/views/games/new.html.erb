<% content_for :title, "ìƒˆ ê²½ê¸° ë§Œë“¤ê¸° - BDR" %>

<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4">
    <!-- ë’¤ë¡œ ê°€ê¸° -->
    <div class="mb-6">
      <%= link_to "â† ê²½ê¸° ëª©ë¡ìœ¼ë¡œ", games_path, class: "text-orange-600 hover:text-orange-800 transition duration-300" %>
    </div>

    <!-- í—¤ë” -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <div class="text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ€ ìƒˆ ê²½ê¸° ë§Œë“¤ê¸°</h1>
        <p class="text-gray-600">3ë‹¨ê³„ë¡œ ê°„í¸í•˜ê²Œ ê²½ê¸°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
      </div>
    </div>

    <%= form_with model: @game, local: true, html: { id: "gameForm", novalidate: true } do |form| %>
      
      <!-- ë‹¨ê³„ í‘œì‹œ -->
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <div class="flex justify-center">
          <div class="flex items-center space-x-4">
            <div class="flex items-center">
              <div id="step1-indicator" class="w-10 h-10 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold">1</div>
              <span class="ml-3 text-sm font-medium text-orange-600">ê¸°ë³¸ ì •ë³´</span>
            </div>
            <div id="step1-2-line" class="w-12 h-1 bg-gray-300"></div>
            <div class="flex items-center">
              <div id="step2-indicator" class="w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold">2</div>
              <span class="ml-3 text-sm font-medium text-gray-500">ì„¸ë¶€ ë‚´ìš©</span>
            </div>
            <div id="step2-3-line" class="w-12 h-1 bg-gray-300"></div>
            <div class="flex items-center">
              <div id="step3-indicator" class="w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold">3</div>
              <span class="ml-3 text-sm font-medium text-gray-500">ì¶”ê°€ ìš”êµ¬ì‚¬í•­</span>
            </div>
          </div>
        </div>
      </div>

      <% if @game.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
          <h3 class="text-red-800 font-semibold mb-3">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:</h3>
          <ul class="text-red-700 space-y-1">
            <% @game.errors.full_messages.each do |message| %>
              <li>â€¢ <%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <!-- 1ë‹¨ê³„: ê¸°ë³¸ ì •ë³´ -->
      <div id="step1" class="step-content bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">1</span>
          ê¸°ë³¸ ì •ë³´
        </h2>
        
        <div class="space-y-6">
          <!-- ê²½ê¸° ì¢…ë¥˜ ì„ íƒ -->
          <div>
            <%= form.label :game_type, "ê²½ê¸° ì¢…ë¥˜", class: "block text-sm font-medium text-gray-700 mb-3" %>
            <div class="space-y-3">
              <% Game::GAME_TYPES.each do |type, description| %>
                <label class="game-type-option block">
                  <%= form.radio_button :game_type, type, class: "sr-only game-type-radio", required: true %>
                  <div class="game-type-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-orange-300 hover:shadow-md hover:bg-orange-25 transition-all duration-300 transform hover:scale-[1.02]">
                    <div class="text-lg font-bold text-gray-800 mb-1"><%= type %></div>
                    <div class="text-sm text-gray-600"><%= description %></div>
                  </div>
                </label>
              <% end %>
            </div>
          </div>
          
          <!-- íŒ€ëª… ì…ë ¥ -->
          <div>
            <%= form.label :team_name, "íŒ€ëª…", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :team_name, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "íŒ€ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (2-50ì)", required: true %>
          </div>
          
          <!-- ì§€ì—­ ì„ íƒ -->
          <div class="grid grid-cols-2 gap-3">
            <div>
              <%= form.label :city, "ì‹œ/ë„", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.select :city, 
                    options_for_select([['ì„ íƒí•˜ì„¸ìš”', '']] + @cities.map { |city| [city, city] }),
                    {},
                    {
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                      id: "game_city",
                      onchange: "updateDistricts()",
                      required: true
                    } %>
            </div>
            
            <div>
              <%= form.label :district, "ì‹œ/êµ°/êµ¬", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.select :district, 
                    [['ë¨¼ì € ì‹œ/ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”', '']],
                    {},
                    {
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                      id: "game_district",
                      required: true
                    } %>
            </div>
          </div>
        </div>
        
        <div class="flex justify-end mt-8">
          <button type="button" id="next-step-1" class="px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition duration-300">
            ë‹¤ìŒ ë‹¨ê³„ â†’
          </button>
        </div>
      </div>

      <!-- 2ë‹¨ê³„: ì„¸ë¶€ ë‚´ìš© -->
      <div id="step2" class="step-content bg-white rounded-lg shadow-lg p-6 mb-8 hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">2</span>
          ì„¸ë¶€ ë‚´ìš©
        </h2>
        
        <div class="space-y-6">
          <!-- ê²½ê¸° ì œëª© -->
          <div>
            <%= form.label :title, "ê²½ê¸° ì œëª©", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :title, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "ê²½ê¸° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (5-100ì)", required: true %>
          </div>
          
          <!-- ì²´ìœ¡ê´€ ì •ë³´ -->
          <div>
            <%= form.label :venue_name, "ì²´ìœ¡ê´€ëª…", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :venue_name, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "ì²´ìœ¡ê´€ ì´ë¦„", required: true %>
          </div>
          
          <div>
            <%= form.label :venue_address, "ì²´ìœ¡ê´€ ì£¼ì†Œ", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :venue_address, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "ìƒì„¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”", required: true %>
          </div>
          
          <!-- ë‚ ì§œ -->
          <div>
            <%= form.label :scheduled_at, "ê²½ê¸° ë‚ ì§œ", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.date_field :scheduled_at, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  min: Date.current, required: true %>
          </div>
          
          <!-- ì‹œê°„ -->
          <div class="grid grid-cols-2 gap-3">
            <div>
              <%= form.label :start_time, "ì‹œì‘ì‹œê°„", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <div class="flex gap-2">
                <select name="start_hour" id="start_hour" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                  <option value="">ì‹œ</option>
                  <% (6..23).each do |hour| %>
                    <option value="<%= hour %>"><%= hour %>ì‹œ</option>
                  <% end %>
                </select>
                <select name="start_minute" id="start_minute" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                  <option value="">ë¶„</option>
                  <% [0, 10, 20, 30, 40, 50].each do |minute| %>
                    <option value="<%= minute %>"><%= sprintf('%02d', minute) %>ë¶„</option>
                  <% end %>
                </select>
              </div>
              <%= form.hidden_field :start_time, id: "game_start_time", required: false %>
            </div>
            
            <div>
              <%= form.label :end_time, "ì¢…ë£Œì‹œê°„", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <div class="flex gap-2">
                <select name="end_hour" id="end_hour" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                  <option value="">ì‹œ</option>
                  <% (6..23).each do |hour| %>
                    <option value="<%= hour %>"><%= hour %>ì‹œ</option>
                  <% end %>
                </select>
                <select name="end_minute" id="end_minute" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                  <option value="">ë¶„</option>
                  <% [0, 10, 20, 30, 40, 50].each do |minute| %>
                    <option value="<%= minute %>"><%= sprintf('%02d', minute) %>ë¶„</option>
                  <% end %>
                </select>
              </div>
              <%= form.hidden_field :end_time, id: "game_end_time", required: false %>
            </div>
          </div>
          
          <!-- ì°¸ê°€ì ìˆ˜ì™€ ë ˆë²¨ -->
          <div class="grid grid-cols-2 gap-3">
            <div>
              <%= form.label :max_players, "ìµœëŒ€ ì°¸ê°€ì", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.number_field :max_players, 
                    class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                    min: 2, max: 30, value: 10, required: true %>
            </div>
            
            <div>
              <%= form.label :level, "ê²½ê¸° ë ˆë²¨", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.select :level, 
                    options_for_select(Game::LEVELS.map { |level, name| ["#{level}. #{name}", level] }),
                    { prompt: 'ë ˆë²¨ ì„ íƒ' },
                    { class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500", required: true } %>
            </div>
          </div>
          
          <!-- ì°¸ê°€ë¹„ -->
          <div>
            <%= form.label :fee, "ì°¸ê°€ë¹„ (ì›)", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.number_field :fee, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  min: 0, value: 0, step: 1000,
                  placeholder: "0 (ë¬´ë£Œ)", required: true %>
          </div>
          
          <!-- ìœ ë‹ˆí¼ ìƒ‰ìƒ ì„ íƒ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-3">ì¤€ë¹„í•´ì•¼ í•  ìœ ë‹ˆí¼ ìƒ‰ìƒ (ìµœëŒ€ 2ê°œ)</label>
            <p class="text-sm text-gray-500 mb-4">ì°¸ê°€ìë“¤ì´ ì¤€ë¹„í•´ì•¼ í•  ìœ ë‹ˆí¼ ìƒ‰ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
            
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
              <% uniform_colors = [
                   ['í°ìƒ‰', 'white', '#FFFFFF'],
                   ['ê²€ì€ìƒ‰', 'black', '#000000'],
                   ['íŒŒë€ìƒ‰', 'blue', '#3B82F6'],
                   ['ë…¸ë€ìƒ‰', 'yellow', '#EAB308'],
                   ['ë¹¨ê°„ìƒ‰', 'red', '#EF4444']
                 ] %>
              
              <% uniform_colors.each do |color_name, color_value, color_code| %>
                <label class="uniform-color-option block cursor-pointer">
                  <input type="checkbox" name="game[uniform_colors][]" value="<%= color_value %>" 
                         class="sr-only uniform-color-checkbox" 
                         onchange="updateUniformColorSelection()">
                  <div class="uniform-color-card border-2 border-gray-200 rounded-lg p-3 hover:border-orange-300 hover:shadow-md transition-all duration-300 text-center">
                    <div class="w-12 h-12 rounded-full mx-auto mb-2 border-2 border-gray-300 flex items-center justify-center"
                         style="background-color: <%= color_code %>; <%= color_value == 'white' ? 'border-color: #D1D5DB;' : 'border-color: ' + color_code + ';' %>">
                      <% if color_value == 'white' %>
                        <span class="text-gray-600 text-xs font-bold">í°</span>
                      <% elsif color_value == 'black' %>
                        <span class="text-white text-xs font-bold">ê²€</span>
                      <% else %>
                        <span class="text-white text-xs font-bold drop-shadow-md"><%= color_name.first %></span>
                      <% end %>
                    </div>
                    <div class="text-sm font-medium text-gray-800"><%= color_name %></div>
                  </div>
                </label>
              <% end %>
            </div>
            
            <div class="mt-2 text-xs text-gray-500">
              <span id="uniform-color-count">0</span>/2ê°œ ì„ íƒë¨
            </div>
          </div>
        </div>
        
        <div class="flex justify-between mt-8">
          <button type="button" id="prev-step-2" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300">
            â† ì´ì „ ë‹¨ê³„
          </button>
          <button type="button" id="next-step-2" class="px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition duration-300">
            ë‹¤ìŒ ë‹¨ê³„ â†’
          </button>
        </div>
      </div>

      <!-- 3ë‹¨ê³„: ì¶”ê°€ ìš”êµ¬ì‚¬í•­ -->
      <div id="step3" class="step-content bg-white rounded-lg shadow-lg p-6 mb-8 hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">3</span>
          ì¶”ê°€ ìš”êµ¬ì‚¬í•­
        </h2>
        
        <div class="space-y-4">
          <p class="text-sm text-gray-600 mb-4">ì²´ìœ¡ê´€ì—ì„œ í•„ìš”í•œ ì‹œì„¤ì„ ì„ íƒí•´ì£¼ì„¸ìš” (ì„ íƒì‚¬í•­)</p>
          
          <!-- ì‹œì„¤ ìš”êµ¬ì‚¬í•­ -->
          <div class="space-y-3">
            <!-- ì£¼ì°¨ -->
            <label class="facility-item flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
              <%= form.check_box :parking_required, class: "w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500" %>
              <div class="ml-3 flex items-center">
                <span class="text-2xl mr-3">ğŸš—</span>
                <div>
                  <div class="font-medium text-gray-900">ì£¼ì°¨ ê°€ëŠ¥</div>
                  <div class="text-sm text-gray-500">ì°¨ëŸ‰ ì´ìš© ì‹œ í•„ìˆ˜</div>
                </div>
              </div>
            </label>
            
            <!-- ìƒ¤ì›Œì‹¤ -->
            <label class="facility-item flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
              <%= form.check_box :shower_required, class: "w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500" %>
              <div class="ml-3 flex items-center">
                <span class="text-2xl mr-3">ğŸš¿</span>
                <div>
                  <div class="font-medium text-gray-900">ìƒ¤ì›Œ ê°€ëŠ¥</div>
                  <div class="text-sm text-gray-500">ê²½ê¸° í›„ ìƒ¤ì›Œ í•„ìš”</div>
                </div>
              </div>
            </label>
            
            <!-- ì •ìˆ˜ê¸° -->
            <label class="facility-item flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
              <%= form.check_box :water_fountain_required, class: "w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500" %>
              <div class="ml-3 flex items-center">
                <span class="text-2xl mr-3">ğŸ’§</span>
                <div>
                  <div class="font-medium text-gray-900">ì •ìˆ˜ê¸°</div>
                  <div class="text-sm text-gray-500">ê¹¨ë—í•œ ë¬¼ ê³µê¸‰</div>
                </div>
              </div>
            </label>
            
            <!-- ëƒ‰ë‚œë°© -->
            <label class="facility-item flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
              <%= form.check_box :air_conditioning_required, class: "w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500" %>
              <div class="ml-3 flex items-center">
                <span class="text-2xl mr-3">â„ï¸</span>
                <div>
                  <div class="font-medium text-gray-900">ëƒ‰ë‚œë°©</div>
                  <div class="text-sm text-gray-500">ì¾Œì í•œ ì‹¤ë‚´ ì˜¨ë„</div>
                </div>
              </div>
            </label>
          </div>
          
          <!-- ì „ë‹¬ì‚¬í•­ -->
          <div class="mt-6">
            <%= form.label :message, "ê°„ë‹¨í•œ ì „ë‹¬ì‚¬í•­", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_area :message, rows: 4,
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "ì°¸ê°€ìë“¤ì—ê²Œ ì „ë‹¬í•˜ê³  ì‹¶ì€ ë‚´ìš©ì´ ìˆìœ¼ë©´ ì‘ì„±í•´ì£¼ì„¸ìš”..." %>
          </div>
          
          <!-- ê²½ê¸° ì„¤ëª… -->
          <div>
            <%= form.label :description, "ê²½ê¸° ì„¤ëª… (ì„ íƒì‚¬í•­)", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_area :description, rows: 3,
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "ê²½ê¸°ì— ëŒ€í•œ ì¶”ê°€ ì„¤ëª…..." %>
          </div>
        </div>
        
        <div class="flex justify-between mt-8">
          <button type="button" id="prev-step-3" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300">
            â† ì´ì „ ë‹¨ê³„
          </button>
          <div class="flex items-center space-x-4">
            <%= link_to "ì·¨ì†Œ", games_path, class: "px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300" %>
            <%= form.submit "ğŸ€ ê²½ê¸° ìƒì„±í•˜ê¸°", 
                  class: "px-8 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition duration-300 transform hover:scale-105" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
// ì§€ì—­ ë°ì´í„°
const locationData = <%= raw @locations.to_json %>;

// í˜„ì¬ ë‹¨ê³„ ì¶”ì 
let currentStep = 1;

function updateDistricts() {
  const citySelect = document.getElementById('game_city');
  const districtSelect = document.getElementById('game_district');
  const selectedCity = citySelect.value;
  
  // êµ¬/êµ° ì„ íƒ ì´ˆê¸°í™”
  districtSelect.innerHTML = '';
  
  if (selectedCity && locationData[selectedCity]) {
    // ì„ íƒëœ ì‹œ/ë„ì˜ êµ¬/êµ° ëª©ë¡ ì¶”ê°€
    const districts = locationData[selectedCity].map(location => location.district).sort();
    
    // ê¸°ë³¸ ì˜µì…˜ ì¶”ê°€
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'êµ¬/êµ°ì„ ì„ íƒí•˜ì„¸ìš”';
    districtSelect.appendChild(defaultOption);
    
    // êµ¬/êµ° ì˜µì…˜ë“¤ ì¶”ê°€
    districts.forEach(district => {
      const option = document.createElement('option');
      option.value = district;
      option.textContent = district;
      districtSelect.appendChild(option);
    });
  } else {
    // ê¸°ë³¸ ìƒíƒœ
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'ë¨¼ì € ì‹œ/ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”';
    districtSelect.appendChild(defaultOption);
  }
}

function updateGameTypeSelection() {
  // ëª¨ë“  ê²Œì„ íƒ€ì… ì˜µì…˜ ì´ˆê¸°í™”
  document.querySelectorAll('.game-type-card').forEach(card => {
    card.classList.remove('border-orange-500', 'bg-orange-50', 'shadow-lg', 'ring-2', 'ring-orange-200');
    card.classList.add('border-gray-200');
  });
  
  // ì„ íƒëœ ë¼ë””ì˜¤ ë²„íŠ¼ ì°¾ê¸°
  const selectedRadio = document.querySelector('.game-type-radio:checked');
  
  if (selectedRadio) {
    const selectedCard = selectedRadio.closest('.game-type-option').querySelector('.game-type-card');
    if (selectedCard) {
      selectedCard.classList.remove('border-gray-200');
      selectedCard.classList.add('border-orange-500', 'bg-orange-50', 'shadow-lg', 'ring-2', 'ring-orange-200');
    }
  }
}

function validateStep(step) {
  const stepElement = document.getElementById(`step${step}`);
  const requiredFields = stepElement.querySelectorAll('input[required], select[required]');
  
  let isValid = true;
  
  requiredFields.forEach(field => {
    // hidden í•„ë“œëŠ” ê²€ì¦ì—ì„œ ì œì™¸
    if (field.type === 'hidden') {
      return;
    }
    
    if (field.type === 'radio') {
      // ë¼ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹ ê²€ì¦
      const radioName = field.name;
      const radioGroup = stepElement.querySelectorAll(`input[name="${radioName}"]`);
      const isRadioChecked = Array.from(radioGroup).some(radio => radio.checked);
      
      if (!isRadioChecked) {
        isValid = false;
        // ë¼ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹ì˜ ëª¨ë“  ì¹´ë“œì— ë¹¨ê°„ í…Œë‘ë¦¬ ì¶”ê°€
        radioGroup.forEach(radio => {
          const card = radio.closest('.game-type-option')?.querySelector('.game-type-card');
          if (card) card.classList.add('border-red-500');
        });
      } else {
        // ë¼ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹ì˜ ëª¨ë“  ì¹´ë“œì—ì„œ ë¹¨ê°„ í…Œë‘ë¦¬ ì œê±°
        radioGroup.forEach(radio => {
          const card = radio.closest('.game-type-option')?.querySelector('.game-type-card');
          if (card) card.classList.remove('border-red-500');
        });
      }
    } else {
      // ì¼ë°˜ í•„ë“œ ê²€ì¦
      if (!field.value || field.value.trim() === '') {
        isValid = false;
        field.classList.add('border-red-500');
      } else {
        field.classList.remove('border-red-500');
      }
    }
  });
  
  // 2ë‹¨ê³„ì—ì„œ ì‹œê°„ í•„ë“œ ì¶”ê°€ ê²€ì¦
  if (step === 2) {
    const startHour = document.getElementById('start_hour');
    const startMinute = document.getElementById('start_minute');
    const endHour = document.getElementById('end_hour');
    const endMinute = document.getElementById('end_minute');
    
    if (!startHour.value || !startMinute.value) {
      isValid = false;
      startHour.classList.add('border-red-500');
      startMinute.classList.add('border-red-500');
    } else {
      startHour.classList.remove('border-red-500');
      startMinute.classList.remove('border-red-500');
    }
    
    if (!endHour.value || !endMinute.value) {
      isValid = false;
      endHour.classList.add('border-red-500');
      endMinute.classList.add('border-red-500');
    } else {
      endHour.classList.remove('border-red-500');
      endMinute.classList.remove('border-red-500');
    }
  }
  
  return isValid;
}

function showStep(step) {
  // ëª¨ë“  ë‹¨ê³„ ìˆ¨ê¸°ê¸°
  document.querySelectorAll('.step-content').forEach(content => {
    content.classList.add('hidden');
  });
  
  // í˜„ì¬ ë‹¨ê³„ í‘œì‹œ
  document.getElementById(`step${step}`).classList.remove('hidden');
  
  // ë‹¨ê³„ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
  updateStepIndicators(step);
  
  // 1ë‹¨ê³„ë¡œ ëŒì•„ê°ˆ ë•Œ ê²Œì„ íƒ€ì… ì„ íƒ ìƒíƒœ ë³µì›
  if (step === 1) {
    setTimeout(() => {
      updateGameTypeSelection();
    }, 10);
  }
  
  currentStep = step;
}

function updateStepIndicators(step) {
  // ëª¨ë“  í‘œì‹œê¸° ì´ˆê¸°í™”
  for (let i = 1; i <= 3; i++) {
    const indicator = document.getElementById(`step${i}-indicator`);
    const span = indicator.nextElementSibling;
    
    if (i <= step) {
      indicator.className = 'w-10 h-10 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold';
      span.className = 'ml-3 text-sm font-medium text-orange-600';
    } else {
      indicator.className = 'w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold';
      span.className = 'ml-3 text-sm font-medium text-gray-500';
    }
  }
  
  // ì—°ê²°ì„  ì—…ë°ì´íŠ¸
  const line1 = document.getElementById('step1-2-line');
  const line2 = document.getElementById('step2-3-line');
  
  if (step >= 2) {
    line1.className = 'w-12 h-1 bg-orange-500';
  } else {
    line1.className = 'w-12 h-1 bg-gray-300';
  }
  
  if (step >= 3) {
    line2.className = 'w-12 h-1 bg-orange-500';
  } else {
    line2.className = 'w-12 h-1 bg-gray-300';
  }
}

function updateUniformColorSelection() {
  const checkboxes = document.querySelectorAll('.uniform-color-checkbox');
  const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
  
  // ì¹´ë“œ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
  checkboxes.forEach(checkbox => {
    const card = checkbox.closest('.uniform-color-option').querySelector('.uniform-color-card');
    if (checkbox.checked) {
      card.classList.remove('border-gray-200');
      card.classList.add('border-orange-500', 'bg-orange-50', 'shadow-lg', 'ring-2', 'ring-orange-200');
    } else {
      card.classList.remove('border-orange-500', 'bg-orange-50', 'shadow-lg', 'ring-2', 'ring-orange-200');
      card.classList.add('border-gray-200');
    }
  });
  
  // ì„ íƒëœ ê°œìˆ˜ ì—…ë°ì´íŠ¸
  document.getElementById('uniform-color-count').textContent = checkedCount;
  
  // 2ê°œ ì´ìƒ ì„ íƒ ì‹œ ë‚˜ë¨¸ì§€ ë¹„í™œì„±í™”
  checkboxes.forEach(checkbox => {
    if (!checkbox.checked && checkedCount >= 2) {
      checkbox.disabled = true;
      const card = checkbox.closest('.uniform-color-option').querySelector('.uniform-color-card');
      card.classList.add('opacity-50', 'cursor-not-allowed');
    } else if (!checkbox.checked) {
      checkbox.disabled = false;
      const card = checkbox.closest('.uniform-color-option').querySelector('.uniform-color-card');
      card.classList.remove('opacity-50', 'cursor-not-allowed');
    }
  });
}

function initializeGameForm() {
  // ì‹œê°„ ì„ íƒ ì²˜ë¦¬
  function updateTimeFields() {
    const startHour = document.getElementById('start_hour').value;
    const startMinute = document.getElementById('start_minute').value;
    const endHour = document.getElementById('end_hour').value;
    const endMinute = document.getElementById('end_minute').value;
    
    console.log('Time values:', {startHour, startMinute, endHour, endMinute});
    
    if (startHour && startMinute !== '') {
      const startTime = `${String(startHour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}`;
      document.getElementById('game_start_time').value = startTime;
      console.log('Start time set to:', startTime);
    }
    
    if (endHour && endMinute !== '') {
      const endTime = `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`;
      document.getElementById('game_end_time').value = endTime;
      console.log('End time set to:', endTime);
    }
  }

  // ì‹œê°„ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
  document.getElementById('start_hour').addEventListener('change', updateTimeFields);
  document.getElementById('start_minute').addEventListener('change', updateTimeFields);
  document.getElementById('end_hour').addEventListener('change', updateTimeFields);
  document.getElementById('end_minute').addEventListener('change', updateTimeFields);
  
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„ íƒëœ ìƒíƒœ í‘œì‹œ
  updateGameTypeSelection();
  
  // ê²½ê¸° ì¢…ë¥˜ ì„ íƒ ê¸°ëŠ¥ - ì¹´ë“œ í´ë¦­
  document.querySelectorAll('.game-type-option').forEach(option => {
    option.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      // ë¼ë””ì˜¤ ë²„íŠ¼ ì²´í¬
      const radio = this.querySelector('.game-type-radio');
      if (radio) {
        radio.checked = true;
        // ì¦‰ì‹œ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        updateGameTypeSelection();
      }
    });
  });
  
  // ë¼ë””ì˜¤ ë²„íŠ¼ change ì´ë²¤íŠ¸ ì²˜ë¦¬
  document.querySelectorAll('.game-type-radio').forEach(radio => {
    radio.addEventListener('change', function() {
      updateGameTypeSelection();
    });
  });
  
  // ìœ ë‹ˆí¼ ìƒ‰ìƒ ì„ íƒ ê¸°ëŠ¥ - ì¹´ë“œ í´ë¦­
  document.querySelectorAll('.uniform-color-option').forEach(option => {
    option.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const checkbox = this.querySelector('.uniform-color-checkbox');
      if (checkbox && !checkbox.disabled) {
        checkbox.checked = !checkbox.checked;
        updateUniformColorSelection();
      }
    });
  });
  
  // ìœ ë‹ˆí¼ ìƒ‰ìƒ ì²´í¬ë°•ìŠ¤ change ì´ë²¤íŠ¸ ì²˜ë¦¬
  document.querySelectorAll('.uniform-color-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      updateUniformColorSelection();
    });
  });
  
  // ì´ˆê¸° ìœ ë‹ˆí¼ ìƒ‰ìƒ ì„ íƒ ìƒíƒœ í‘œì‹œ
  updateUniformColorSelection();
  
  // ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ë“¤
  const nextStep1 = document.getElementById('next-step-1');
  if (nextStep1) {
    nextStep1.addEventListener('click', function() {
      if (validateStep(1)) {
        showStep(2);
      } else {
        alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      }
    });
  }
  
  const nextStep2 = document.getElementById('next-step-2');
  if (nextStep2) {
    nextStep2.addEventListener('click', function() {
      if (validateStep(2)) {
        showStep(3);
      } else {
        alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      }
    });
  }
  
  // ì´ì „ ë‹¨ê³„ ë²„íŠ¼ë“¤
  const prevStep2 = document.getElementById('prev-step-2');
  if (prevStep2) {
    prevStep2.addEventListener('click', function() {
      showStep(1);
    });
  }
  
  const prevStep3 = document.getElementById('prev-step-3');
  if (prevStep3) {
    prevStep3.addEventListener('click', function() {
      showStep(2);
    });
  }
  
  // ì´ˆê¸° ìƒíƒœ ì„¤ì •
  showStep(1);
  
  // í¼ ì œì¶œ ì „ ì‹œê°„ í•„ë“œ ì—…ë°ì´íŠ¸
  const gameForm = document.getElementById('gameForm');
  if (gameForm) {
    gameForm.addEventListener('submit', function(e) {
      console.log('Form submit event triggered');
      
      // ëª¨ë“  ë‹¨ê³„ ê²€ì¦
      for (let i = 1; i <= 3; i++) {
        if (!validateStep(i)) {
          e.preventDefault();
          console.log(`Step ${i} validation failed`);
          alert(`${i}ë‹¨ê³„ì˜ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
          showStep(i);
          return false;
        }
      }
      
      updateTimeFields();
      
      // ì‹œê°„ì´ ì œëŒ€ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
      const startTime = document.getElementById('game_start_time').value;
      const endTime = document.getElementById('game_end_time').value;
      
      console.log('Start time:', startTime);
      console.log('End time:', endTime);
      
      if (!startTime || !endTime) {
        e.preventDefault();
        alert('ì‹œì‘ì‹œê°„ê³¼ ì¢…ë£Œì‹œê°„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return false;
      }
      
      console.log('Form validation passed, submitting...');
    });
  }
}

document.addEventListener('DOMContentLoaded', initializeGameForm);
document.addEventListener('turbo:load', initializeGameForm);
</script>