<% content_for :title, "ÏÉà Í≤ΩÍ∏∞ ÎßåÎì§Í∏∞ - BDR" %>

<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4">
    <!-- Îí§Î°ú Í∞ÄÍ∏∞ -->
    <div class="mb-6">
      <%= link_to "‚Üê Í≤ΩÍ∏∞ Î™©Î°ùÏúºÎ°ú", games_path, class: "text-orange-600 hover:text-orange-800 transition duration-300" %>
    </div>

    <!-- Ìó§Îçî -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <div class="text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">üèÄ ÏÉà Í≤ΩÍ∏∞ ÎßåÎì§Í∏∞</h1>
        <p class="text-gray-600">3Îã®Í≥ÑÎ°ú Í∞ÑÌé∏ÌïòÍ≤å Í≤ΩÍ∏∞Î•º ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî</p>
      </div>
    </div>

    <%= form_with model: @game, local: true, html: { id: "gameForm", novalidate: true } do |form| %>
      
      <!-- Îã®Í≥Ñ ÌëúÏãú -->
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <div class="flex justify-center">
          <div class="flex items-center space-x-4">
            <div class="flex items-center">
              <div id="step1-indicator" class="w-10 h-10 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold">1</div>
              <span class="ml-3 text-sm font-medium text-orange-600">Í∏∞Î≥∏ Ï†ïÎ≥¥</span>
            </div>
            <div id="step1-2-line" class="w-12 h-1 bg-gray-300"></div>
            <div class="flex items-center">
              <div id="step2-indicator" class="w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold">2</div>
              <span class="ml-3 text-sm font-medium text-gray-500">ÏÑ∏Î∂Ä ÎÇ¥Ïö©</span>
            </div>
            <div id="step2-3-line" class="w-12 h-1 bg-gray-300"></div>
            <div class="flex items-center">
              <div id="step3-indicator" class="w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold">3</div>
              <span class="ml-3 text-sm font-medium text-gray-500">Ï∂îÍ∞Ä ÏöîÍµ¨ÏÇ¨Ìï≠</span>
            </div>
          </div>
        </div>
      </div>

      <% if @game.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
          <h3 class="text-red-800 font-semibold mb-3">Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:</h3>
          <ul class="text-red-700 space-y-1">
            <% @game.errors.full_messages.each do |message| %>
              <li>‚Ä¢ <%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <!-- 1Îã®Í≥Ñ: Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
      <div id="step1" class="step-content bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">1</span>
          Í∏∞Î≥∏ Ï†ïÎ≥¥
        </h2>
        
        <div class="space-y-6">
          <!-- Í≤ΩÍ∏∞ Ï¢ÖÎ•ò ÏÑ†ÌÉù -->
          <div>
            <%= form.label :game_type, "Í≤ΩÍ∏∞ Ï¢ÖÎ•ò", class: "block text-sm font-medium text-gray-700 mb-3" %>
            <div class="space-y-3">
              <% Game::GAME_TYPES.each do |type, description| %>
                <label class="game-type-option block">
                  <%= form.radio_button :game_type, type, class: "sr-only game-type-radio", required: true %>
                  <div class="game-type-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-orange-300 hover:shadow-md hover:bg-orange-25 transition-all duration-300 transform hover:scale-[1.02]">
                    <div class="text-lg font-bold text-gray-800 mb-1"><%= type %></div>
                    <div class="text-sm text-gray-600"><%= description %></div>
                  </div>
                </label>
              <% end %>
            </div>
          </div>
          
          <!-- ÌåÄÎ™Ö ÏûÖÎ†• -->
          <div>
            <%= form.label :team_name, "ÌåÄÎ™Ö", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :team_name, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "ÌåÄÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (2-50Ïûê)", required: true %>
          </div>
          
          <!-- ÏßÄÏó≠ ÏÑ†ÌÉù -->
          <div class="grid grid-cols-2 gap-3">
            <div>
              <%= form.label :city, "Ïãú/ÎèÑ", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.select :city, 
                    options_for_select([['ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', '']] + @cities.map { |city| [city, city] }),
                    {},
                    {
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                      id: "game_city",
                      onchange: "updateDistricts()",
                      required: true
                    } %>
            </div>
            
            <div>
              <%= form.label :district, "Ïãú/Íµ∞/Íµ¨", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.select :district, 
                    [['Î®ºÏ†Ä Ïãú/ÎèÑÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', '']],
                    {},
                    {
                      class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                      id: "game_district",
                      required: true
                    } %>
            </div>
          </div>
        </div>
        
        <div class="flex justify-end mt-8">
          <button type="button" id="next-step-1" class="px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition duration-300">
            Îã§Ïùå Îã®Í≥Ñ ‚Üí
          </button>
        </div>
      </div>

      <!-- 2Îã®Í≥Ñ: ÏÑ∏Î∂Ä ÎÇ¥Ïö© -->
      <div id="step2" class="step-content bg-white rounded-lg shadow-lg p-6 mb-8 hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">2</span>
          ÏÑ∏Î∂Ä ÎÇ¥Ïö©
        </h2>
        
        <div class="space-y-6">
          <!-- Í≤ΩÍ∏∞ Ï†úÎ™© -->
          <div>
            <%= form.label :title, "Í≤ΩÍ∏∞ Ï†úÎ™©", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :title, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "Í≤ΩÍ∏∞ Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (5-100Ïûê)", required: true %>
          </div>
          
          <!-- Ï≤¥Ïú°Í¥Ä Ï†ïÎ≥¥ -->
          <div>
            <%= form.label :venue_name, "Ï≤¥Ïú°Í¥ÄÎ™Ö", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :venue_name, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "Ï≤¥Ïú°Í¥Ä Ïù¥Î¶Ñ", required: true %>
          </div>
          
          <div>
            <%= form.label :venue_address, "Ï≤¥Ïú°Í¥Ä Ï£ºÏÜå", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :venue_address, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "ÏÉÅÏÑ∏ Ï£ºÏÜåÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî", required: true %>
          </div>
          
          <!-- ÎÇ†Ïßú -->
          <div>
            <%= form.label :scheduled_at, "Í≤ΩÍ∏∞ ÎÇ†Ïßú", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.date_field :scheduled_at, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  min: Date.current, required: true %>
          </div>
          
          <!-- ÏãúÍ∞Ñ -->
          <div class="grid grid-cols-2 gap-3">
            <div>
              <%= form.label :start_time, "ÏãúÏûëÏãúÍ∞Ñ", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <div class="flex gap-2">
                <select name="start_hour" id="start_hour" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                  <option value="">Ïãú</option>
                  <% (6..23).each do |hour| %>
                    <option value="<%= hour %>"><%= hour %>Ïãú</option>
                  <% end %>
                </select>
                <select name="start_minute" id="start_minute" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                  <option value="">Î∂Ñ</option>
                  <% [0, 10, 20, 30, 40, 50].each do |minute| %>
                    <option value="<%= minute %>"><%= sprintf('%02d', minute) %>Î∂Ñ</option>
                  <% end %>
                </select>
              </div>
              <%= form.hidden_field :start_time, id: "game_start_time", required: false %>
            </div>
            
            <div>
              <%= form.label :end_time, "Ï¢ÖÎ£åÏãúÍ∞Ñ", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <div class="flex gap-2">
                <select name="end_hour" id="end_hour" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                  <option value="">Ïãú</option>
                  <% (6..23).each do |hour| %>
                    <option value="<%= hour %>"><%= hour %>Ïãú</option>
                  <% end %>
                </select>
                <select name="end_minute" id="end_minute" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                  <option value="">Î∂Ñ</option>
                  <% [0, 10, 20, 30, 40, 50].each do |minute| %>
                    <option value="<%= minute %>"><%= sprintf('%02d', minute) %>Î∂Ñ</option>
                  <% end %>
                </select>
              </div>
              <%= form.hidden_field :end_time, id: "game_end_time", required: false %>
            </div>
          </div>
          
          <!-- Ï∞∏Í∞ÄÏûê ÏàòÏôÄ Î†àÎ≤® -->
          <div class="grid grid-cols-2 gap-3">
            <div>
              <%= form.label :max_players, "ÏµúÎåÄ Ï∞∏Í∞ÄÏûê", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.number_field :max_players, 
                    class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                    min: 2, max: 30, value: 10, required: true %>
            </div>
            
            <div>
              <%= form.label :level, "Í≤ΩÍ∏∞ Î†àÎ≤®", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.select :level, 
                    options_for_select(Game::LEVELS.map { |level, name| ["#{level}. #{name}", level] }),
                    { prompt: 'Î†àÎ≤® ÏÑ†ÌÉù' },
                    { class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500", required: true } %>
            </div>
          </div>
          
          <!-- Ï∞∏Í∞ÄÎπÑ -->
          <div>
            <%= form.label :fee, "Ï∞∏Í∞ÄÎπÑ (Ïõê)", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.number_field :fee, 
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  min: 0, value: 0, step: 1000,
                  placeholder: "0 (Î¨¥Î£å)", required: true %>
          </div>
          
          <!-- Ïú†ÎãàÌèº ÏÉâÏÉÅ ÏÑ†ÌÉù -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-3">Ï§ÄÎπÑÌï¥Ïïº Ìï† Ïú†ÎãàÌèº ÏÉâÏÉÅ (ÏµúÎåÄ 2Í∞ú)</label>
            <p class="text-sm text-gray-500 mb-4">Ï∞∏Í∞ÄÏûêÎì§Ïù¥ Ï§ÄÎπÑÌï¥Ïïº Ìï† Ïú†ÎãàÌèº ÏÉâÏÉÅÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.</p>
            
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
              <% uniform_colors = [
                   ['Ìù∞ÏÉâ', 'white', '#FFFFFF'],
                   ['Í≤ÄÏùÄÏÉâ', 'black', '#000000'],
                   ['ÌååÎûÄÏÉâ', 'blue', '#3B82F6'],
                   ['ÎÖ∏ÎûÄÏÉâ', 'yellow', '#EAB308'],
                   ['Îπ®Í∞ÑÏÉâ', 'red', '#EF4444']
                 ] %>
              
              <% uniform_colors.each do |color_name, color_value, color_code| %>
                <label class="uniform-color-option block cursor-pointer">
                  <input type="checkbox" name="game[uniform_colors][]" value="<%= color_value %>" 
                         class="sr-only uniform-color-checkbox" 
                         onchange="updateUniformColorSelection()">
                  <div class="uniform-color-card border-2 border-gray-200 rounded-lg p-3 hover:border-orange-300 hover:shadow-md transition-all duration-300 text-center">
                    <div class="w-12 h-12 rounded-full mx-auto mb-2 border-2 border-gray-300 flex items-center justify-center"
                         style="background-color: <%= color_code %>; <%= color_value == 'white' ? 'border-color: #D1D5DB;' : 'border-color: ' + color_code + ';' %>">
                      <% if color_value == 'white' %>
                        <span class="text-gray-600 text-xs font-bold">Ìù∞</span>
                      <% elsif color_value == 'black' %>
                        <span class="text-white text-xs font-bold">Í≤Ä</span>
                      <% else %>
                        <span class="text-white text-xs font-bold drop-shadow-md"><%= color_name.first %></span>
                      <% end %>
                    </div>
                    <div class="text-sm font-medium text-gray-800"><%= color_name %></div>
                  </div>
                </label>
              <% end %>
            </div>
            
            <div class="mt-2 text-xs text-gray-500">
              <span id="uniform-color-count">0</span>/2Í∞ú ÏÑ†ÌÉùÎê®
            </div>
          </div>
        </div>
        
        <div class="flex justify-between mt-8">
          <button type="button" id="prev-step-2" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300">
            ‚Üê Ïù¥Ï†Ñ Îã®Í≥Ñ
          </button>
          <button type="button" id="next-step-2" class="px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition duration-300">
            Îã§Ïùå Îã®Í≥Ñ ‚Üí
          </button>
        </div>
      </div>

      <!-- 3Îã®Í≥Ñ: Ï∂îÍ∞Ä ÏöîÍµ¨ÏÇ¨Ìï≠ -->
      <div id="step3" class="step-content bg-white rounded-lg shadow-lg p-6 mb-8 hidden">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">3</span>
          Ï∂îÍ∞Ä ÏöîÍµ¨ÏÇ¨Ìï≠
        </h2>
        
        <div class="space-y-4">
          <p class="text-sm text-gray-600 mb-4">Ï≤¥Ïú°Í¥ÄÏóêÏÑú ÌïÑÏöîÌïú ÏãúÏÑ§ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî (ÏÑ†ÌÉùÏÇ¨Ìï≠)</p>
          
          <!-- ÏãúÏÑ§ ÏöîÍµ¨ÏÇ¨Ìï≠ -->
          <div class="space-y-3">
            <!-- Ï£ºÏ∞® -->
            <label class="facility-item flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
              <%= form.check_box :parking_required, class: "w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500" %>
              <div class="ml-3 flex items-center">
                <span class="text-2xl mr-3">üöó</span>
                <div>
                  <div class="font-medium text-gray-900">Ï£ºÏ∞® Í∞ÄÎä•</div>
                  <div class="text-sm text-gray-500">Ï∞®Îüâ Ïù¥Ïö© Ïãú ÌïÑÏàò</div>
                </div>
              </div>
            </label>
            
            <!-- ÏÉ§ÏõåÏã§ -->
            <label class="facility-item flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
              <%= form.check_box :shower_required, class: "w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500" %>
              <div class="ml-3 flex items-center">
                <span class="text-2xl mr-3">üöø</span>
                <div>
                  <div class="font-medium text-gray-900">ÏÉ§Ïõå Í∞ÄÎä•</div>
                  <div class="text-sm text-gray-500">Í≤ΩÍ∏∞ ÌõÑ ÏÉ§Ïõå ÌïÑÏöî</div>
                </div>
              </div>
            </label>
            
            <!-- Ï†ïÏàòÍ∏∞ -->
            <label class="facility-item flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
              <%= form.check_box :water_fountain_required, class: "w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500" %>
              <div class="ml-3 flex items-center">
                <span class="text-2xl mr-3">üíß</span>
                <div>
                  <div class="font-medium text-gray-900">Ï†ïÏàòÍ∏∞</div>
                  <div class="text-sm text-gray-500">Íπ®ÎÅóÌïú Î¨º Í≥µÍ∏â</div>
                </div>
              </div>
            </label>
            
            <!-- ÎÉâÎÇúÎ∞© -->
            <label class="facility-item flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
              <%= form.check_box :air_conditioning_required, class: "w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500" %>
              <div class="ml-3 flex items-center">
                <span class="text-2xl mr-3">‚ùÑÔ∏è</span>
                <div>
                  <div class="font-medium text-gray-900">ÎÉâÎÇúÎ∞©</div>
                  <div class="text-sm text-gray-500">ÏæåÏ†ÅÌïú Ïã§ÎÇ¥ Ïò®ÎèÑ</div>
                </div>
              </div>
            </label>
          </div>
          
          <!-- Ï†ÑÎã¨ÏÇ¨Ìï≠ -->
          <div class="mt-6">
            <%= form.label :message, "Í∞ÑÎã®Ìïú Ï†ÑÎã¨ÏÇ¨Ìï≠", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_area :message, rows: 4,
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "Ï∞∏Í∞ÄÏûêÎì§ÏóêÍ≤å Ï†ÑÎã¨ÌïòÍ≥† Ïã∂ÏùÄ ÎÇ¥Ïö©Ïù¥ ÏûàÏúºÎ©¥ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî..." %>
          </div>
          
          <!-- Í≤ΩÍ∏∞ ÏÑ§Î™Ö -->
          <div>
            <%= form.label :description, "Í≤ΩÍ∏∞ ÏÑ§Î™Ö (ÏÑ†ÌÉùÏÇ¨Ìï≠)", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_area :description, rows: 3,
                  class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",
                  placeholder: "Í≤ΩÍ∏∞Ïóê ÎåÄÌïú Ï∂îÍ∞Ä ÏÑ§Î™Ö..." %>
          </div>
        </div>
        
        <div class="flex justify-between mt-8">
          <button type="button" id="prev-step-3" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300">
            ‚Üê Ïù¥Ï†Ñ Îã®Í≥Ñ
          </button>
          <div class="flex items-center space-x-4">
            <%= link_to "Ï∑®ÏÜå", games_path, class: "px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300" %>
            <%= form.submit "üèÄ Í≤ΩÍ∏∞ ÏÉùÏÑ±ÌïòÍ∏∞", 
                  class: "px-8 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition duration-300 transform hover:scale-105" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
// ÏßÄÏó≠ Îç∞Ïù¥ÌÑ∞
const locationData = <%= raw @locations.to_json %>;

// ÌòÑÏû¨ Îã®Í≥Ñ Ï∂îÏ†Å
let currentStep = 1;

function updateDistricts() {
  const citySelect = document.getElementById('game_city');
  const districtSelect = document.getElementById('game_district');
  const selectedCity = citySelect.value;
  
  // Íµ¨/Íµ∞ ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
  districtSelect.innerHTML = '';
  
  if (selectedCity && locationData[selectedCity]) {
    // ÏÑ†ÌÉùÎêú Ïãú/ÎèÑÏùò Íµ¨/Íµ∞ Î™©Î°ù Ï∂îÍ∞Ä
    const districts = locationData[selectedCity].map(location => location.district).sort();
    
    // Í∏∞Î≥∏ ÏòµÏÖò Ï∂îÍ∞Ä
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'Íµ¨/Íµ∞ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî';
    districtSelect.appendChild(defaultOption);
    
    // Íµ¨/Íµ∞ ÏòµÏÖòÎì§ Ï∂îÍ∞Ä
    districts.forEach(district => {
      const option = document.createElement('option');
      option.value = district;
      option.textContent = district;
      districtSelect.appendChild(option);
    });
  } else {
    // Í∏∞Î≥∏ ÏÉÅÌÉú
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'Î®ºÏ†Ä Ïãú/ÎèÑÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî';
    districtSelect.appendChild(defaultOption);
  }
}

function updateGameTypeSelection() {
  // Î™®Îì† Í≤åÏûÑ ÌÉÄÏûÖ ÏòµÏÖò Ï¥àÍ∏∞Ìôî
  document.querySelectorAll('.game-type-card').forEach(card => {
    card.classList.remove('border-orange-500', 'bg-orange-50', 'shadow-lg', 'ring-2', 'ring-orange-200');
    card.classList.add('border-gray-200');
  });
  
  // ÏÑ†ÌÉùÎêú ÎùºÎîîÏò§ Î≤ÑÌäº Ï∞æÍ∏∞
  const selectedRadio = document.querySelector('.game-type-radio:checked');
  
  if (selectedRadio) {
    const selectedCard = selectedRadio.closest('.game-type-option').querySelector('.game-type-card');
    if (selectedCard) {
      selectedCard.classList.remove('border-gray-200');
      selectedCard.classList.add('border-orange-500', 'bg-orange-50', 'shadow-lg', 'ring-2', 'ring-orange-200');
    }
  }
}

function validateStep(step) {
  const stepElement = document.getElementById(`step${step}`);
  const requiredFields = stepElement.querySelectorAll('input[required], select[required]');
  
  let isValid = true;
  
  requiredFields.forEach(field => {
    // hidden ÌïÑÎìúÎäî Í≤ÄÏ¶ùÏóêÏÑú Ï†úÏô∏
    if (field.type === 'hidden') {
      return;
    }
    
    if (field.type === 'radio') {
      // ÎùºÎîîÏò§ Î≤ÑÌäº Í∑∏Î£π Í≤ÄÏ¶ù
      const radioName = field.name;
      const radioGroup = stepElement.querySelectorAll(`input[name="${radioName}"]`);
      const isRadioChecked = Array.from(radioGroup).some(radio => radio.checked);
      
      if (!isRadioChecked) {
        isValid = false;
        // ÎùºÎîîÏò§ Î≤ÑÌäº Í∑∏Î£πÏùò Î™®Îì† Ïπ¥ÎìúÏóê Îπ®Í∞Ñ ÌÖåÎëêÎ¶¨ Ï∂îÍ∞Ä
        radioGroup.forEach(radio => {
          const card = radio.closest('.game-type-option')?.querySelector('.game-type-card');
          if (card) card.classList.add('border-red-500');
        });
      } else {
        // ÎùºÎîîÏò§ Î≤ÑÌäº Í∑∏Î£πÏùò Î™®Îì† Ïπ¥ÎìúÏóêÏÑú Îπ®Í∞Ñ ÌÖåÎëêÎ¶¨ Ï†úÍ±∞
        radioGroup.forEach(radio => {
          const card = radio.closest('.game-type-option')?.querySelector('.game-type-card');
          if (card) card.classList.remove('border-red-500');
        });
      }
    } else {
      // ÏùºÎ∞ò ÌïÑÎìú Í≤ÄÏ¶ù
      if (!field.value || field.value.trim() === '') {
        isValid = false;
        field.classList.add('border-red-500');
      } else {
        field.classList.remove('border-red-500');
      }
    }
  });
  
  // 2Îã®Í≥ÑÏóêÏÑú ÏãúÍ∞Ñ ÌïÑÎìú Ï∂îÍ∞Ä Í≤ÄÏ¶ù
  if (step === 2) {
    const startHour = document.getElementById('start_hour');
    const startMinute = document.getElementById('start_minute');
    const endHour = document.getElementById('end_hour');
    const endMinute = document.getElementById('end_minute');
    
    if (!startHour.value || !startMinute.value) {
      isValid = false;
      startHour.classList.add('border-red-500');
      startMinute.classList.add('border-red-500');
    } else {
      startHour.classList.remove('border-red-500');
      startMinute.classList.remove('border-red-500');
    }
    
    if (!endHour.value || !endMinute.value) {
      isValid = false;
      endHour.classList.add('border-red-500');
      endMinute.classList.add('border-red-500');
    } else {
      endHour.classList.remove('border-red-500');
      endMinute.classList.remove('border-red-500');
    }
  }
  
  return isValid;
}

function showStep(step) {
  // Î™®Îì† Îã®Í≥Ñ Ïà®Í∏∞Í∏∞
  document.querySelectorAll('.step-content').forEach(content => {
    content.classList.add('hidden');
  });
  
  // ÌòÑÏû¨ Îã®Í≥Ñ ÌëúÏãú
  document.getElementById(`step${step}`).classList.remove('hidden');
  
  // Îã®Í≥Ñ ÌëúÏãúÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏
  updateStepIndicators(step);
  
  // 1Îã®Í≥ÑÎ°ú ÎèåÏïÑÍ∞à Îïå Í≤åÏûÑ ÌÉÄÏûÖ ÏÑ†ÌÉù ÏÉÅÌÉú Î≥µÏõê
  if (step === 1) {
    setTimeout(() => {
      updateGameTypeSelection();
    }, 10);
  }
  
  currentStep = step;
}

function updateStepIndicators(step) {
  // Î™®Îì† ÌëúÏãúÍ∏∞ Ï¥àÍ∏∞Ìôî
  for (let i = 1; i <= 3; i++) {
    const indicator = document.getElementById(`step${i}-indicator`);
    const span = indicator.nextElementSibling;
    
    if (i <= step) {
      indicator.className = 'w-10 h-10 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold';
      span.className = 'ml-3 text-sm font-medium text-orange-600';
    } else {
      indicator.className = 'w-10 h-10 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center font-bold';
      span.className = 'ml-3 text-sm font-medium text-gray-500';
    }
  }
  
  // Ïó∞Í≤∞ÏÑ† ÏóÖÎç∞Ïù¥Ìä∏
  const line1 = document.getElementById('step1-2-line');
  const line2 = document.getElementById('step2-3-line');
  
  if (step >= 2) {
    line1.className = 'w-12 h-1 bg-orange-500';
  } else {
    line1.className = 'w-12 h-1 bg-gray-300';
  }
  
  if (step >= 3) {
    line2.className = 'w-12 h-1 bg-orange-500';
  } else {
    line2.className = 'w-12 h-1 bg-gray-300';
  }
}

function updateUniformColorSelection() {
  const checkboxes = document.querySelectorAll('.uniform-color-checkbox');
  const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
  
  // Ïπ¥Îìú Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
  checkboxes.forEach(checkbox => {
    const card = checkbox.closest('.uniform-color-option').querySelector('.uniform-color-card');
    if (checkbox.checked) {
      card.classList.remove('border-gray-200');
      card.classList.add('border-orange-500', 'bg-orange-50', 'shadow-lg', 'ring-2', 'ring-orange-200');
    } else {
      card.classList.remove('border-orange-500', 'bg-orange-50', 'shadow-lg', 'ring-2', 'ring-orange-200');
      card.classList.add('border-gray-200');
    }
  });
  
  // ÏÑ†ÌÉùÎêú Í∞úÏàò ÏóÖÎç∞Ïù¥Ìä∏
  document.getElementById('uniform-color-count').textContent = checkedCount;
  
  // 2Í∞ú Ïù¥ÏÉÅ ÏÑ†ÌÉù Ïãú ÎÇòÎ®∏ÏßÄ ÎπÑÌôúÏÑ±Ìôî
  checkboxes.forEach(checkbox => {
    if (!checkbox.checked && checkedCount >= 2) {
      checkbox.disabled = true;
      const card = checkbox.closest('.uniform-color-option').querySelector('.uniform-color-card');
      card.classList.add('opacity-50', 'cursor-not-allowed');
    } else if (!checkbox.checked) {
      checkbox.disabled = false;
      const card = checkbox.closest('.uniform-color-option').querySelector('.uniform-color-card');
      card.classList.remove('opacity-50', 'cursor-not-allowed');
    }
  });
}

function initializeGameForm() {
  // ÏãúÍ∞Ñ ÏÑ†ÌÉù Ï≤òÎ¶¨
  function updateTimeFields() {
    const startHour = document.getElementById('start_hour').value;
    const startMinute = document.getElementById('start_minute').value;
    const endHour = document.getElementById('end_hour').value;
    const endMinute = document.getElementById('end_minute').value;
    
    console.log('Time values:', {startHour, startMinute, endHour, endMinute});
    
    if (startHour && startMinute !== '') {
      const startTime = `${String(startHour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}`;
      document.getElementById('game_start_time').value = startTime;
      console.log('Start time set to:', startTime);
    }
    
    if (endHour && endMinute !== '') {
      const endTime = `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`;
      document.getElementById('game_end_time').value = endTime;
      console.log('End time set to:', endTime);
    }
  }

  // ÏãúÍ∞Ñ ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
  document.getElementById('start_hour').addEventListener('change', updateTimeFields);
  document.getElementById('start_minute').addEventListener('change', updateTimeFields);
  document.getElementById('end_hour').addEventListener('change', updateTimeFields);
  document.getElementById('end_minute').addEventListener('change', updateTimeFields);
  
  // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏÑ†ÌÉùÎêú ÏÉÅÌÉú ÌëúÏãú
  updateGameTypeSelection();
  
  // Í≤ΩÍ∏∞ Ï¢ÖÎ•ò ÏÑ†ÌÉù Í∏∞Îä• - Ïπ¥Îìú ÌÅ¥Î¶≠
  document.querySelectorAll('.game-type-option').forEach(option => {
    option.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      // ÎùºÎîîÏò§ Î≤ÑÌäº Ï≤¥ÌÅ¨
      const radio = this.querySelector('.game-type-radio');
      if (radio) {
        radio.checked = true;
        // Ï¶âÏãú ÏÑ†ÌÉù ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        updateGameTypeSelection();
      }
    });
  });
  
  // ÎùºÎîîÏò§ Î≤ÑÌäº change Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
  document.querySelectorAll('.game-type-radio').forEach(radio => {
    radio.addEventListener('change', function() {
      updateGameTypeSelection();
    });
  });
  
  // Ïú†ÎãàÌèº ÏÉâÏÉÅ ÏÑ†ÌÉù Í∏∞Îä• - Ïπ¥Îìú ÌÅ¥Î¶≠
  document.querySelectorAll('.uniform-color-option').forEach(option => {
    option.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const checkbox = this.querySelector('.uniform-color-checkbox');
      if (checkbox && !checkbox.disabled) {
        checkbox.checked = !checkbox.checked;
        updateUniformColorSelection();
      }
    });
  });
  
  // Ïú†ÎãàÌèº ÏÉâÏÉÅ Ï≤¥ÌÅ¨Î∞ïÏä§ change Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
  document.querySelectorAll('.uniform-color-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      updateUniformColorSelection();
    });
  });
  
  // Ï¥àÍ∏∞ Ïú†ÎãàÌèº ÏÉâÏÉÅ ÏÑ†ÌÉù ÏÉÅÌÉú ÌëúÏãú
  updateUniformColorSelection();
  
  // Îã§Ïùå Îã®Í≥Ñ Î≤ÑÌäºÎì§
  const nextStep1 = document.getElementById('next-step-1');
  if (nextStep1) {
    nextStep1.addEventListener('click', function() {
      if (validateStep(1)) {
        showStep(2);
      } else {
        alert('Î™®Îì† ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      }
    });
  }
  
  const nextStep2 = document.getElementById('next-step-2');
  if (nextStep2) {
    nextStep2.addEventListener('click', function() {
      if (validateStep(2)) {
        showStep(3);
      } else {
        alert('Î™®Îì† ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      }
    });
  }
  
  // Ïù¥Ï†Ñ Îã®Í≥Ñ Î≤ÑÌäºÎì§
  const prevStep2 = document.getElementById('prev-step-2');
  if (prevStep2) {
    prevStep2.addEventListener('click', function() {
      showStep(1);
    });
  }
  
  const prevStep3 = document.getElementById('prev-step-3');
  if (prevStep3) {
    prevStep3.addEventListener('click', function() {
      showStep(2);
    });
  }
  
  // Ï¥àÍ∏∞ ÏÉÅÌÉú ÏÑ§Ï†ï
  showStep(1);
  
  // Ìèº Ï†úÏ∂ú Ï†Ñ ÏãúÍ∞Ñ ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏
  const gameForm = document.getElementById('gameForm');
  if (gameForm) {
    gameForm.addEventListener('submit', function(e) {
      console.log('Form submit event triggered');
      
      // Î™®Îì† Îã®Í≥Ñ Í≤ÄÏ¶ù
      for (let i = 1; i <= 3; i++) {
        if (!validateStep(i)) {
          e.preventDefault();
          console.log(`Step ${i} validation failed`);
          alert(`${i}Îã®Í≥ÑÏùò ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.`);
          showStep(i);
          return false;
        }
      }
      
      updateTimeFields();
      
      // ÏãúÍ∞ÑÏù¥ Ï†úÎåÄÎ°ú ÏÑ§Ï†ïÎêòÏóàÎäîÏßÄ ÌôïÏù∏
      const startTime = document.getElementById('game_start_time').value;
      const endTime = document.getElementById('game_end_time').value;
      
      console.log('Start time:', startTime);
      console.log('End time:', endTime);
      
      if (!startTime || !endTime) {
        e.preventDefault();
        alert('ÏãúÏûëÏãúÍ∞ÑÍ≥º Ï¢ÖÎ£åÏãúÍ∞ÑÏùÑ Î™®Îëê ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
        return false;
      }
      
      console.log('Form validation passed, submitting...');
    });
  }
}

document.addEventListener('DOMContentLoaded', initializeGameForm);
document.addEventListener('turbo:load', initializeGameForm);
</script>