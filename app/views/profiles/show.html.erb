<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-6xl mx-auto px-4">
    <!-- í”„ë¡œí•„ í—¤ë” -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
        <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
        <div class="relative">
          <div class="w-20 h-20 md:w-32 md:h-32 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white text-2xl md:text-4xl font-bold shadow-lg">
            <%= @user.nickname&.first&.upcase || @user.name&.first&.upcase || 'U' %>
          </div>
          <div class="absolute -bottom-1 -right-1 md:-bottom-2 md:-right-2 bg-green-500 w-6 h-6 md:w-8 md:h-8 rounded-full border-2 md:border-4 border-white flex items-center justify-center">
            <span class="text-white text-xs">ğŸ€</span>
          </div>
        </div>
        
        <!-- ê¸°ë³¸ ì •ë³´ -->
        <div class="flex-1 text-center md:text-left">
          <h1 class="text-3xl font-bold text-gray-800 mb-2"><%= @user.nickname || @user.name || 'ì‚¬ìš©ì' %></h1>
          <p class="text-gray-600 mb-2"><%= @user.position_names.join(', ') || 'í¬ì§€ì…˜ ë¯¸ì„¤ì •' %> â€¢ í‚¤ <%= @user.height || 'ë¯¸ì„¤ì •' %>cm</p>
          <% if @user.bio.present? %>
            <p class="text-gray-500 text-sm mb-4 italic"><%= @user.bio %></p>
          <% end %>
          
          <div class="flex flex-wrap justify-center md:justify-start gap-4 mb-6">
            <% if @user.city && @user.district %>
              <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-semibold">
                ğŸ“ <%= @user.city %> <%= @user.district %>
              </span>
            <% end %>
            <% if @user.position_names.any? %>
              <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">
                ğŸ€ <%= @user.position_names.first %>
              </span>
            <% end %>
            <% if @user.team_name.present? %>
              <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                ğŸ€ <%= @user.team_name %>
              </span>
            <% end %>
            <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-semibold inline-flex items-center">
              â­ í‰ì  <%= @user.evaluation_rating_percentage %>% <span class="text-xs ml-1">(<%= @user.rating_count %>ê°œ)</span>
            </span>
          </div>
          
          <div class="flex flex-wrap justify-center md:justify-between items-end gap-3">
            <div class="flex flex-wrap gap-3">
              <%= link_to "í”„ë¡œí•„ ìˆ˜ì •", profile_edit_path, class: "bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg transition duration-300" %>
              <%= link_to "ê²Œì„ ê¸°ë¡", profile_history_path, class: "bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-300" %>
              <%= link_to "í†µê³„ ë³´ê¸°", profile_stats_path, class: "bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition duration-300" %>
              <%= link_to "ì•Œë¦¼ ì„¤ì •", notification_settings_user_path(@user), class: "bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg transition duration-300" %>
            </div>
            
            <!-- í”„ë¡œí•„ ì™„ì„±ë„ (ë°ìŠ¤í¬í†±ì—ì„œë§Œ í‘œì‹œ) -->
            <div class="hidden md:block bg-gradient-to-br from-yellow-400 to-orange-500 text-white px-4 py-2 rounded-lg shadow-lg">
              <div class="text-center">
                <div class="text-xl font-bold"><%= @profile_completion %>%</div>
                <div class="text-xs">í”„ë¡œí•„ ì™„ì„±ë„</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ê³„ì¢Œ ì •ë³´ (í˜¸ìŠ¤íŠ¸ìš©) -->
    <% if @user.bank_name.present? && @user.account_number.present? %>
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ’° í˜¸ìŠ¤íŠ¸ ê³„ì¢Œ ì •ë³´</h2>
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="text-center">
              <div class="text-sm text-gray-600">ì€í–‰</div>
              <div class="font-semibold text-gray-800"><%= @user.bank_name %></div>
            </div>
            <div class="text-center">
              <div class="text-sm text-gray-600">ê³„ì¢Œë²ˆí˜¸</div>
              <div class="font-mono font-semibold text-gray-800"><%= @user.account_number %></div>
            </div>
            <div class="text-center">
              <div class="text-sm text-gray-600">ì˜ˆê¸ˆì£¼</div>
              <div class="font-semibold text-gray-800"><%= @user.account_holder %></div>
            </div>
          </div>
          <div class="mt-3 text-xs text-blue-600 text-center">
            í˜¸ìŠ¤íŠ¸ë¡œ ê²½ê¸° ì£¼ìµœ ì‹œ ì°¸ê°€ë¹„ê°€ ì´ ê³„ì¢Œë¡œ ì…ê¸ˆë©ë‹ˆë‹¤
          </div>
        </div>
      </div>
    <% end %>

    <!-- ì‹ ì²­ í˜„í™© & ì£¼ìµœí•œ ê²½ê¸° -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <!-- ì‹ ì²­ í˜„í™© -->
      <div class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="mr-3">ğŸ“‹</span>
          ì‹ ì²­ í˜„í™©
        </h2>
        
        <% if @recent_applications.any? %>
          <div class="space-y-4">
            <% @recent_applications.select { |app| app.game.present? }.each do |application| %>
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-300">
                <div class="mb-3">
                  <h4 class="font-semibold text-gray-800 text-base mb-1">
                    <%= link_to application.game&.title || 'ê²½ê¸° ì •ë³´ ì—†ìŒ', application.game ? game_path(application.game) : '#', class: "hover:text-orange-600 transition duration-300" %>
                  </h4>
                  <div class="text-sm text-gray-600 mb-2">
                    ğŸ“… <%= application.applied_at.strftime("%m/%d %H:%M") %>
                  </div>
                  <div class="text-sm text-gray-600 mb-2">
                    ğŸ“ <%= application.game&.court&.name || application.game&.venue_name || 'ì¥ì†Œ ë¯¸ì •' %>
                  </div>
                </div>
                
                <div class="flex justify-between items-center">
                  <div class="flex flex-col space-y-1">
                    <% if application.pending? %>
                      <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-semibold">
                        â³ ìŠ¹ì¸ ëŒ€ê¸°ì¤‘
                      </span>
                    <% elsif application.waiting_payment? %>
                      <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-semibold">
                        ğŸ’³ ì…ê¸ˆ ëŒ€ê¸°ì¤‘
                      </span>
                      <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-semibold">
                        â‚©<%= number_with_delimiter(application.game&.fee || 0) %>
                      </span>
                    <% elsif application.final_approved? %>
                      <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold">
                        âœ… ìµœì¢… ìŠ¹ì¸ë¨
                      </span>
                      <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-semibold">
                        ğŸ’° ì°¸ê°€ í™•ì •
                      </span>
                    <% elsif application.rejected? %>
                      <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs font-semibold">
                        âŒ ê±°ì ˆë¨
                      </span>
                    <% end %>
                  </div>
                  
                  <div class="text-right">
                    <div class="text-sm text-gray-500">
                      <%= application.game&.confirmed_players_count || 0 %>/<%= application.game&.max_players || 0 %>ëª…
                    </div>
                    <div class="text-sm text-gray-500">
                      <%= (application.game&.max_players || 0) - (application.game&.confirmed_players_count || 0) %>ìë¦¬ ë‚¨ìŒ
                    </div>
                  </div>
                </div>
                
                <!-- ê²°ì œ ì¹´ë“œ (waiting_payment ìƒíƒœì¼ ë•Œë§Œ í‘œì‹œ) -->
                <% if application.waiting_payment? %>
                  <div class="mt-4 bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <div class="flex items-center mb-2">
                      <span class="text-orange-600 text-lg mr-2">ğŸ’³</span>
                      <span class="text-orange-800 font-semibold">ê²°ì œ í•„ìš”</span>
                    </div>
                    <div class="text-sm text-orange-700 mb-3">
                      ê²½ê¸° ì°¸ê°€ê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤! ì°¸ê°€ë¹„ë¥¼ ê²°ì œí•´ì£¼ì„¸ìš”.
                    </div>
                    <div class="text-lg font-bold text-gray-800 mb-3">
                      ì°¸ê°€ë¹„: <%= number_with_delimiter(application.game&.fee || 0) %>ì›
                    </div>
                    <button type="button" id="payment-btn-<%= application.id %>" 
                            onclick="processPayment('<%= application.game&.game_id || '' %>', '<%= application.id %>', '<%= application.game&.fee || 0 %>', '<%= application.game&.title || 'ê²½ê¸°' %>')"
                        class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 text-center">
                      <span class="payment-text">ğŸ’³ ê²°ì œí•˜ê¸°</span>
                      <span class="payment-loading hidden">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        ê²°ì œ ì²˜ë¦¬ ì¤‘...
                      </span>
                    </button>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center text-gray-500 py-8">
            <div class="text-4xl mb-3">ğŸ“</div>
            <div class="text-lg mb-2">ì‹ ì²­í•œ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            <div class="text-sm">ìƒˆë¡œìš´ ê²½ê¸°ì— ì°¸ê°€í•´ë³´ì„¸ìš”!</div>
            <%= link_to "ê²½ê¸° ì°¾ê¸°", games_path, class: "inline-block mt-3 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition duration-300" %>
          </div>
        <% end %>
      </div>

      <!-- ì£¼ìµœí•œ ê²½ê¸° -->
      <div id="hosted-games" class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="mr-3">ğŸ¯</span>
          ì£¼ìµœí•œ ê²½ê¸°
        </h2>
        
        <% if @organized_games.any? %>
          <div class="space-y-4">
            <% @organized_games.each do |game| %>
              <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-300">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <div class="flex items-center mb-2">
                      <h4 class="font-semibold text-gray-800 mr-3">
                        <%= link_to game.title, game_path(game), class: "hover:text-orange-600 transition duration-300" %>
                      </h4>
                      <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-semibold">
                        <%= game.game_type %>
                      </span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-sm text-gray-600">
                      <div class="flex items-center">
                        <span class="w-4 text-orange-500">ğŸ“</span>
                        <span class="truncate"><%= game.court&.name || game.venue_name %></span>
                      </div>
                      
                      <div class="flex items-center">
                        <span class="w-4 text-blue-500">â°</span>
                        <span><%= game.scheduled_at.strftime("%m/%d %H:%M") %></span>
                      </div>
                      
                      <div class="flex items-center">
                        <span class="w-4 text-green-500">ğŸ‘¥</span>
                        <span><%= game.confirmed_players_count %>/<%= game.max_players %>ëª…</span>
                      </div>
                    </div>
                    
                    <!-- í˜¸ìŠ¤íŠ¸ ìˆ˜ìµ ì •ë³´ -->
                    <% if game.fee && game.fee > 0 %>
                      <div class="mt-3 p-3 bg-green-50 border border-green-200 rounded-lg">
                        <div class="flex items-center justify-between text-sm">
                          <div class="flex items-center">
                            <span class="w-4 text-green-600">ğŸ’°</span>
                            <span class="text-green-800 font-semibold">í˜¸ìŠ¤íŠ¸ ìˆ˜ìµ</span>
                          </div>
                          <div class="text-right">
                            <div class="text-green-700">
                              <%= game.confirmed_players_count %>ëª… Ã— <%= number_with_delimiter(game.fee) %>ì› = 
                              <span class="font-bold"><%= number_with_delimiter(game.expected_host_revenue) %>ì›</span>
                            </div>
                            <div class="text-xs text-green-600 mt-1">
                              <% if game.current_platform_fee_percentage > 0 %>
                                (í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ <%= game.current_platform_fee_percentage.to_i %>% ì œì™¸)
                              <% end %>
                            </div>
                            <% if game.payment_completion_rate < 100 %>
                              <div class="text-xs text-orange-600 mt-1">
                                ê²°ì œ ì™„ë£Œìœ¨: <%= game.payment_completion_rate %>%
                              </div>
                            <% end %>
                          </div>
                        </div>
                      </div>
                    <% end %>
                  </div>
                  
                  <div class="text-right ml-4">
                    <% pending_count = game.game_applications.pending.count %>
                    <% if pending_count > 0 %>
                      <div class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-semibold mb-2">
                        ì‹ ì²­ ëŒ€ê¸°: <%= pending_count %>ëª…
                      </div>
                    <% end %>
                    <%= link_to "ìƒì„¸ ë³´ê¸°", game_path(game), class: "bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-xs transition duration-300" %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center text-gray-500 py-8">
            <div class="text-4xl mb-3">ğŸ€</div>
            <div class="text-lg">ì£¼ìµœí•œ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            <div class="text-sm mt-2">ìƒˆë¡œìš´ ê²½ê¸°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</div>
            <%= link_to "ìƒˆ ê²½ê¸° ë§Œë“¤ê¸°", new_game_path, class: "inline-block mt-3 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition duration-300" %>
          </div>
        <% end %>
        
        <%= link_to "ì „ì²´ ê¸°ë¡ ë³´ê¸°", profile_history_path, class: "block w-full text-center bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg transition duration-300 mt-4" %>
      </div>
    </div>

    <!-- í‰ì  -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
        <span class="mr-3">ğŸ€</span>
        í‰ì  ë° í‰ê°€
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- ì „ì²´ í‰ì  -->
        <div class="text-center">
          <h3 class="text-lg font-semibold text-gray-700 mb-4">ì „ì²´ í‰ì </h3>
          <div class="mb-4">
            <div class="text-5xl font-bold text-yellow-500 mb-2"><%= @user.evaluation_rating_percentage %>%</div>
            <%= basketball_rating_display(@user.average_rating) %>
          </div>
          <div class="text-sm text-gray-600">ì´ <%= @user.rating_count %>ê°œì˜ í‰ê°€</div>
          <div class="text-xs text-gray-500 mt-2">
            ì‹¤ë ¥ ë ˆë²¨: <%= @user.skill_level_name %> (Lv.<%= @user.skill_level %>)
          </div>
        </div>
        
        <!-- ì„¸ë¶€ í‰ê°€ í•­ëª© -->
        <div>
          <h3 class="text-lg font-semibold text-gray-700 mb-4">ì„¸ë¶€ í‰ê°€</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-gray-600">ì‹¤ë ¥</span>
              <div class="flex items-center">
                <div class="w-32 bg-gray-200 rounded-full h-2 mr-2">
                  <div class="bg-blue-600 h-2 rounded-full" style="width: <%= (@user.skill_level_average / 5.0 * 100).round %>%"></div>
                </div>
                <span class="text-sm text-gray-700"><%= @user.skill_level_average.round(1) %>/5.0</span>
              </div>
            </div>
            
            <div class="flex justify-between items-center">
              <span class="text-gray-600">íŒ€ì›Œí¬</span>
              <div class="flex items-center">
                <div class="w-32 bg-gray-200 rounded-full h-2 mr-2">
                  <div class="bg-green-600 h-2 rounded-full" style="width: <%= (@user.teamwork_average / 5.0 * 100).round %>%"></div>
                </div>
                <span class="text-sm text-gray-700"><%= @user.teamwork_average.round(1) %>/5.0</span>
              </div>
            </div>
            
            <div class="flex justify-between items-center">
              <span class="text-gray-600">ë§¤ë„ˆ</span>
              <div class="flex items-center">
                <div class="w-32 bg-gray-200 rounded-full h-2 mr-2">
                  <div class="bg-purple-600 h-2 rounded-full" style="width: <%= (@user.manner_average / 5.0 * 100).round %>%"></div>
                </div>
                <span class="text-sm text-gray-700"><%= @user.manner_average.round(1) %>/5.0</span>
              </div>
            </div>
            
            <% if @user.memorable_count > 0 %>
              <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-center">
                  <span class="text-yellow-600 mr-2">ğŸŒŸ</span>
                  <span class="text-sm text-yellow-800">
                    <strong><%= @user.memorable_count %>ëª…</strong>ì˜ ë™ë£Œê°€ ì´ í”Œë ˆì´ì–´ë¥¼ ê¸°ì–µì— ë‚¨ëŠ” ì„ ìˆ˜ë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤!
                  </span>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- í‰ì  ë³€ë™ ë‚´ì—­ -->
    <% if @rating_histories.any? %>
      <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
          <span class="mr-3">ğŸ“Š</span>
          í‰ì  ë³€ë™ ë‚´ì—­
        </h2>
        
        <div class="space-y-4">
          <% @rating_histories.each do |history| %>
            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-300">
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <div class="flex items-center mb-2">
                    <% if history.positive_change? %>
                      <span class="text-2xl mr-3">ğŸ“ˆ</span>
                      <span class="text-green-600 font-bold text-lg">+<%= history.rating_change %>%</span>
                    <% elsif history.negative_change? %>
                      <span class="text-2xl mr-3">ğŸ“‰</span>
                      <span class="text-red-600 font-bold text-lg"><%= history.rating_change %>%</span>
                    <% else %>
                      <span class="text-2xl mr-3">â–</span>
                      <span class="text-gray-600 font-bold text-lg">ë³€ë™ ì—†ìŒ</span>
                    <% end %>
                    
                    <span class="mx-3 text-gray-400">â†’</span>
                    <span class="text-lg font-semibold text-gray-800"><%= history.rating_after %>%</span>
                  </div>
                  
                  <div class="text-sm text-gray-600">
                    <div class="flex items-center">
                      <span class="mr-2">ğŸ€</span>
                      <%= link_to history.game.title, game_path(history.game), class: "hover:text-orange-600 transition duration-300" %>
                    </div>
                    <div class="mt-1 text-xs text-gray-500">
                      í‰ê°€ ì¸ì›: <%= history.evaluation_count %>ëª…
                      <% if history.positive_count > 0 %>
                        <span class="ml-2 text-green-600">ê¸ì • <%= history.positive_count %>ëª…</span>
                      <% end %>
                      <% if history.negative_count > 0 %>
                        <span class="ml-2 text-red-600">ë¶€ì • <%= history.negative_count %>ëª…</span>
                      <% end %>
                    </div>
                  </div>
                </div>
                
                <div class="text-right text-sm text-gray-500">
                  <%= history.created_at.strftime("%m/%d %H:%M") %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- í†µê³„ ì¹´ë“œë“¤ -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow-lg p-6 text-center">
        <div class="text-3xl font-bold text-orange-500 mb-2"><%= @user.game_applications.final_approved.count %></div>
        <div class="text-gray-600 text-sm">ì°¸ê°€í•œ ê²½ê¸°</div>
        <div class="text-xs text-gray-400 mt-1">ìµœì¢… ìŠ¹ì¸ëœ ê²½ê¸°ë§Œ</div>
      </div>
      
      <div class="bg-white rounded-lg shadow-lg p-6 text-center hover:shadow-xl transition duration-300 cursor-pointer" onclick="scrollToSection('hosted-games')">
        <div class="text-3xl font-bold text-green-500 mb-2"><%= @user.organized_games.count %></div>
        <div class="text-gray-600 text-sm">ì£¼ìµœí•œ ê²Œì„</div>
      </div>
      
      <div class="bg-white rounded-lg shadow-lg p-6 text-center">
        <div class="text-3xl font-bold text-purple-500 mb-2"><%= @user.game_applications.count %></div>
        <div class="text-gray-600 text-sm">ì‹ ì²­ ê²Œì„</div>
      </div>
    </div>

    <!-- ì—…ì  ë° í¬ì¸íŠ¸ ì„¹ì…˜ -->
    <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg shadow-lg p-8 mb-8 text-white">
      <h2 class="text-2xl font-bold mb-6">ğŸ† ì—…ì  & í¬ì¸íŠ¸</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <!-- ì „ì²´ ì§„í–‰ë¥  -->
        <div class="bg-white/20 backdrop-blur rounded-lg p-4">
          <div class="text-sm opacity-90">ì „ì²´ ì§„í–‰ë¥ </div>
          <div class="text-2xl font-bold"><%= @achievement_progress %>%</div>
          <div class="w-full bg-white/30 rounded-full h-2 mt-2">
            <div class="bg-white rounded-full h-2" style="width: <%= @achievement_progress %>%"></div>
          </div>
          <div class="text-xs mt-1 opacity-90"><%= @unlocked_achievements_count %> / <%= @total_achievements_count %>ê°œ ë‹¬ì„±</div>
        </div>
        
        <!-- ì´ í¬ì¸íŠ¸ -->
        <div class="bg-white/20 backdrop-blur rounded-lg p-4">
          <div class="text-sm opacity-90">ì´ í¬ì¸íŠ¸</div>
          <div class="text-2xl font-bold"><%= number_with_delimiter(@user.total_points || 0) %>P</div>
          <div class="text-xs mt-1 opacity-90">ì´ë²ˆ ë‹¬: +<%= number_with_delimiter(@points_this_month || 0) %>P</div>
        </div>
        
        <!-- ìµœê·¼ ì—…ì  -->
        <div class="bg-white/20 backdrop-blur rounded-lg p-4">
          <div class="text-sm opacity-90">ìµœê·¼ íšë“</div>
          <% if @recent_achievement %>
            <div class="text-lg font-bold"><%= @recent_achievement.achievement.name %></div>
            <div class="text-xs mt-1 opacity-90"><%= @recent_achievement.created_at.strftime('%m/%d') %> ë‹¬ì„±</div>
          <% else %>
            <div class="text-lg">ì•„ì§ ì—†ìŒ</div>
          <% end %>
        </div>
      </div>
      
      <!-- ëª¨ë“  ì—…ì  ë°°ì§€ë“¤ -->
      <div class="bg-white/10 backdrop-blur rounded-lg p-4">
        <% if @achievements_by_category && @achievements_by_category.any? %>
          <% @achievements_by_category.each do |category, achievements| %>
            <div class="mb-3">
              <h4 class="text-xs font-semibold mb-2 opacity-90">
                <%= achievement_category_name(category) %> 
                <span class="opacity-70">(<%= achievements.count { |a| @unlocked_achievement_ids.include?(a.id) } %>/<%= achievements.count %>)</span>
              </h4>
              
              <div class="grid grid-cols-8 md:grid-cols-12 lg:grid-cols-16 gap-1">
                <% achievements.each do |achievement| %>
                  <% unlocked = @unlocked_achievement_ids.include?(achievement.id) %>
                  <div class="relative group">
                    <div class="bg-white/20 rounded p-1 text-center transition-all duration-300 hover:bg-white/30 
                                <%= unlocked ? '' : 'opacity-40' %>"
                         style="<%= unlocked ? '' : 'filter: grayscale(100%);' %>">
                      <div class="text-lg">
                        <%= achievement.icon %>
                      </div>
                    </div>
                    
                    <!-- í˜¸ë²„ íˆ´íŒ -->
                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 p-2 bg-gray-900 text-white text-xs rounded-lg 
                                opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10">
                      <p class="font-semibold mb-1"><%= achievement.name %></p>
                      <p class="text-gray-300"><%= achievement.description %></p>
                      <% if unlocked %>
                        <% user_achievement = @user_achievements.find { |ua| ua.achievement_id == achievement.id } %>
                        <p class="text-purple-300 mt-1">
                          <%= user_achievement.created_at.strftime('%Yë…„ %mì›” %dì¼') %> ë‹¬ì„±
                        </p>
                      <% else %>
                        <p class="text-gray-400 mt-1">ì•„ì§ ë‹¬ì„±í•˜ì§€ ëª»í•¨</p>
                      <% end %>
                      <div class="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                        <div class="border-4 border-transparent border-t-gray-900"></div>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        <% else %>
          <p class="text-white/70 text-center text-sm">ì—…ì  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- ì…ê¸ˆ ì •ë³´ ëª¨ë‹¬ -->
<div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold text-gray-800">ğŸ’³ ì…ê¸ˆ ì •ë³´</h3>
      <button onclick="hidePaymentModal()" class="text-gray-400 hover:text-gray-600">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <div class="space-y-4">
      <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
        <h4 class="font-semibold text-orange-800 mb-2">ğŸ¦ BDR ì…ê¸ˆ ê³„ì¢Œ</h4>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-600">ì€í–‰ëª…:</span>
            <span class="font-medium">ì‹ í•œì€í–‰</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ê³„ì¢Œë²ˆí˜¸:</span>
            <span class="font-medium">110-123-456789</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ì˜ˆê¸ˆì£¼:</span>
            <span class="font-medium">BDR í”Œë«í¼</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ì…ê¸ˆìëª…:</span>
            <span class="font-medium"><%= current_user.name %></span>
          </div>
        </div>
      </div>
      
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h4 class="font-semibold text-blue-800 mb-2">ğŸ“ ì…ê¸ˆ ì•ˆë‚´</h4>
        <ul class="text-sm text-blue-700 space-y-1">
          <li>â€¢ ì…ê¸ˆìëª…ì€ ê°€ì…í•œ ì´ë¦„ê³¼ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤</li>
          <li>â€¢ ì…ê¸ˆ í›„ ìë™ìœ¼ë¡œ í™•ì¸ë˜ë©° í˜¸ìŠ¤íŠ¸ì—ê²Œ ì•Œë¦¼ì´ ê°‘ë‹ˆë‹¤</li>
          <li>â€¢ ê²½ê¸° ì¢…ë£Œ 2ì¼ í›„ í˜¸ìŠ¤íŠ¸ì—ê²Œ ìë™ ì†¡ê¸ˆë©ë‹ˆë‹¤</li>
          <li>â€¢ ê²½ê¸° ì·¨ì†Œ ì‹œ ì „ì•¡ í™˜ë¶ˆë©ë‹ˆë‹¤</li>
        </ul>
      </div>
      
      <div class="flex justify-end space-x-3">
        <button onclick="hidePaymentModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
          ë‹«ê¸°
        </button>
        <button onclick="copyAccountInfo()" class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-md">
          ê³„ì¢Œë²ˆí˜¸ ë³µì‚¬
        </button>
      </div>
    </div>
  </div>
</div>

<!-- í† ìŠ¤í˜ì´ë¨¼ì¸  SDK -->
<script src="https://js.tosspayments.com/v1/payment"></script>

<script>
function scrollToSection(sectionId) {
  const section = document.getElementById(sectionId);
  if (section) {
    section.scrollIntoView({ 
      behavior: 'smooth',
      block: 'start'
    });
  }
}

function showPaymentInfo(applicationId) {
  document.getElementById('paymentModal').classList.remove('hidden');
  document.getElementById('paymentModal').classList.add('flex');
}

function hidePaymentModal() {
  document.getElementById('paymentModal').classList.add('hidden');
  document.getElementById('paymentModal').classList.remove('flex');
}

// í† ìŠ¤í˜ì´ë¨¼ì¸  SDK
const clientKey = "test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq"
let tossPayments;

// TossPayments ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, checking TossPayments...');
  
  // SDK ë¡œë“œ í™•ì¸ ë° ì´ˆê¸°í™”
  function initializeTossPayments() {
    if (typeof TossPayments === 'undefined') {
      console.log('TossPayments SDK not loaded yet, waiting...');
      setTimeout(initializeTossPayments, 200);
      return;
    }
    
    try {
      tossPayments = TossPayments(clientKey);
      console.log('TossPayments initialized successfully in profile page:', tossPayments);
      console.log('TossPayments methods:', Object.keys(tossPayments));
    } catch (error) {
      console.error('Failed to initialize TossPayments:', error);
    }
  }
  
  // ì´ˆê¸°í™” ì‹œì‘
  initializeTossPayments();
});

// ê²°ì œ ì²˜ë¦¬ í•¨ìˆ˜
function processPayment(gameId, applicationId, amount, gameName) {
  console.log('processPayment called with:', { gameId, applicationId, amount, gameName });
  
  // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
  const paymentBtn = document.getElementById(`payment-btn-${applicationId}`);
  const paymentText = paymentBtn.querySelector('.payment-text');
  const paymentLoading = paymentBtn.querySelector('.payment-loading');
  
  // ë¡œë”© ìƒíƒœ í‘œì‹œ
  paymentText.classList.add('hidden');
  paymentLoading.classList.remove('hidden');
  paymentBtn.disabled = true;
  paymentBtn.classList.add('opacity-75', 'cursor-not-allowed');
  
  // ë²„íŠ¼ ìƒíƒœ ë³µì› í•¨ìˆ˜
  function resetButton() {
    paymentText.classList.remove('hidden');
    paymentLoading.classList.add('hidden');
    paymentBtn.disabled = false;
    paymentBtn.classList.remove('opacity-75', 'cursor-not-allowed');
  }
  
  if (!tossPayments) {
    console.error('TossPayments not initialized!');
    resetButton();
    alert('ê²°ì œ ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ê²°ì œ ì •ë³´ ìƒì„±
  const orderId = `BDR-${gameId}-${applicationId}-${Date.now()}`;
  const orderName = `${gameName} ì°¸ê°€ë¹„`;
  const customerName = '<%= current_user.name %>';
  const customerEmail = '<%= current_user.email %>';
  const baseUrl = '<%= request.protocol + request.host_with_port %>';
  
  console.log('Payment info:', {
    amount: parseInt(amount),
    orderId: orderId,
    orderName: orderName,
    customerName: customerName,
    customerEmail: customerEmail,
    successUrl: `${baseUrl}/payments/success`,
    failUrl: `${baseUrl}/payments/fail`
  });
  
  try {
    // TossPaymentsì— ê²°ì œ ìš”ì²­
    tossPayments.requestPayment('ì¹´ë“œ', {
      amount: parseInt(amount),
      orderId: orderId,
      orderName: orderName,
      customerName: customerName,
      customerEmail: customerEmail,
      successUrl: `${baseUrl}/payments/success`,
      failUrl: `${baseUrl}/payments/fail`,
    }).catch(function (error) {
      console.error('Payment error:', error);
      resetButton();
      
      if (error.code === 'USER_CANCEL') {
        console.log('User cancelled payment');
        // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²½ìš° ë³„ë„ ì•Œë¦¼ ì—†ìŒ
      } else {
        alert('ê²°ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    });
  } catch (error) {
    console.error('Payment request failed:', error);
    resetButton();
    alert('ê²°ì œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
  }
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
document.getElementById('paymentModal').addEventListener('click', function(e) {
  if (e.target === this) {
    hidePaymentModal();
  }
});

// ì—…ì  ì¹´í…Œê³ ë¦¬ ì´ë¦„ í—¬í¼
function achievement_category_name(category) {
  const names = {
    'participation': 'ì°¸ê°€',
    'host': 'í˜¸ìŠ¤íŠ¸',  
    'social': 'ì†Œì…œ',
    'skill': 'ì‹¤ë ¥',
    'special': 'íŠ¹ë³„'
  };
  return names[category] || category;
}
</script>

<%
# Ruby í—¬í¼ ë©”ì„œë“œ
def achievement_category_name(category)
  {
    'participation' => 'ì°¸ê°€',
    'host' => 'í˜¸ìŠ¤íŠ¸',
    'social' => 'ì†Œì…œ', 
    'skill' => 'ì‹¤ë ¥',
    'special' => 'íŠ¹ë³„'
  }[category] || category
end
%>
