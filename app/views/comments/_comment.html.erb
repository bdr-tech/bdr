<div class="comment-thread" data-depth="<%= comment.depth %>">
  <div class="flex space-x-3 <%= 'ml-' + [(comment.depth * 8), 48].min.to_s if comment.depth > 0 %>">
    <!-- ÌîÑÎ°úÌïÑ ÏïÑÎ∞îÌÉÄ -->
    <div class="flex-shrink-0">
      <div class="w-8 h-8 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-xs">
        <%= comment.author_name.first %>
      </div>
    </div>
    
    <!-- ÎåìÍ∏Ä ÎÇ¥Ïö© -->
    <div class="flex-1 min-w-0">
      <div class="bg-gray-50 rounded-lg p-4">
        <!-- ÎåìÍ∏Ä Ìó§Îçî -->
        <div class="flex justify-between items-start mb-2">
          <div class="flex items-center space-x-2">
            <span class="font-semibold text-gray-800 text-sm"><%= comment.author_name %></span>
            <span class="text-xs text-gray-500"><%= time_ago_in_words(comment.created_at) %>Ï†Ñ</span>
            <% if comment.depth > 0 %>
              <span class="text-xs text-blue-600">‚îî ÎãµÍ∏Ä</span>
            <% end %>
          </div>
          
          <% if current_user == comment.user %>
            <div class="flex space-x-2">
              <%= link_to "ÏàòÏ†ï", edit_post_comment_path(post, comment), 
                    class: "text-xs text-gray-500 hover:text-gray-700 transition duration-300" %>
              <%= link_to "ÏÇ≠Ï†ú", post_comment_path(post, comment), method: :delete,
                    data: { confirm: "ÎåìÍ∏ÄÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?" },
                    class: "text-xs text-red-500 hover:text-red-700 transition duration-300" %>
            </div>
          <% end %>
        </div>
        
        <!-- ÎåìÍ∏Ä ÌÖçÏä§Ìä∏ -->
        <div class="text-gray-700 text-sm">
          <%= simple_format(comment.content) %>
        </div>
        
        <!-- ÎãµÍ∏Ä Î≤ÑÌäº -->
        <% if logged_in? && comment.can_reply? %>
          <div class="mt-3 pt-2 border-t border-gray-200">
            <button onclick="toggleReplyForm(<%= comment.id %>)" 
                    class="text-xs text-orange-600 hover:text-orange-800 transition duration-300">
              üí¨ ÎãµÍ∏Ä
            </button>
          </div>
        <% end %>
      </div>
      
      <!-- ÎãµÍ∏Ä ÏûëÏÑ± Ìèº (Ïà®Í≤®Ïßê) -->
      <% if logged_in? && comment.can_reply? %>
        <div id="reply-form-<%= comment.id %>" class="mt-3 hidden">
          <%= form_with model: [post, Comment.new], local: true, class: "space-y-3" do |form| %>
            <%= hidden_field_tag :parent_id, comment.id %>
            <%= form.text_area :content, rows: 2,
                  class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",
                  placeholder: "#{comment.author_name}ÎãòÏóêÍ≤å ÎãµÍ∏Ä..." %>
            <div class="flex justify-end space-x-2">
              <button type="button" onclick="toggleReplyForm(<%= comment.id %>)"
                      class="px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition duration-300">
                Ï∑®ÏÜå
              </button>
              <%= form.submit "ÎãµÍ∏Ä ÏûëÏÑ±", 
                    class: "px-4 py-1 bg-orange-500 hover:bg-orange-600 text-white text-sm rounded transition duration-300" %>
            </div>
          <% end %>
        </div>
      <% end %>
      
      <!-- ÎåÄÎåìÍ∏ÄÎì§ -->
      <% if comment.replies.any? %>
        <div class="mt-4 space-y-4">
          <% comment.replies.oldest_first.each do |reply| %>
            <%= render 'comments/comment', comment: reply, post: post %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
function toggleReplyForm(commentId) {
  const form = document.getElementById('reply-form-' + commentId);
  const isHidden = form.classList.contains('hidden');
  
  // Î™®Îì† Îã§Î•∏ ÎãµÍ∏Ä Ìèº Ïà®Í∏∞Í∏∞
  document.querySelectorAll('[id^="reply-form-"]').forEach(f => {
    if (f.id !== 'reply-form-' + commentId) {
      f.classList.add('hidden');
    }
  });
  
  // ÌòÑÏû¨ Ìèº ÌÜ†Í∏Ä
  if (isHidden) {
    form.classList.remove('hidden');
    form.querySelector('textarea').focus();
  } else {
    form.classList.add('hidden');
  }
}
</script>