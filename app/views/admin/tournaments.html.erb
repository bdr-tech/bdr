<div class="admin-page">
  <div class="page-header">
    <h1>대회 관리</h1>
    <p class="page-subtitle">프리미엄 회원이 등록한 대회를 검토하고 승인하세요</p>
  </div>
  
  <% if @pending_tournaments.any? %>
    <div class="alert alert-warning mb-4">
      <strong>승인 대기중인 대회가 <%= @pending_tournaments.count %>개 있습니다.</strong>
    </div>
  <% end %>
  
  <!-- 검색 및 필터 -->
  <div class="admin-filters mb-4">
    <%= form_with url: admin_tournaments_path, method: :get, local: true, class: "row g-3" do |f| %>
      <div class="col-md-6">
        <%= f.text_field :search, value: params[:search], 
            placeholder: "대회명 또는 설명 검색...", 
            class: "form-control" %>
      </div>
      <div class="col-md-3">
        <%= f.select :status, 
            options_for_select([
              ['전체 상태', ''],
              ['준비중', 'draft'],
              ['승인 대기', 'pending_approval'],
              ['공개됨', 'published'],
              ['등록 접수중', 'registration_open'],
              ['등록 마감', 'registration_closed'],
              ['진행중', 'ongoing'],
              ['종료', 'completed'],
              ['취소됨', 'cancelled'],
              ['거절됨', 'rejected']
            ], params[:status]), 
            { prompt: '상태 선택' },
            class: "form-select" %>
      </div>
      <div class="col-md-3">
        <%= f.submit "검색", class: "btn btn-primary" %>
        <%= link_to "초기화", admin_tournaments_path, class: "btn btn-secondary" %>
      </div>
    <% end %>
  </div>
  
  <!-- 승인 대기 대회 섹션 -->
  <% if @pending_tournaments.any? %>
    <div class="card mb-4">
      <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">승인 대기 대회</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>대회명</th>
                <th>주최자</th>
                <th>대회 일정</th>
                <th>참가비</th>
                <th>등록일</th>
                <th>작업</th>
              </tr>
            </thead>
            <tbody>
              <% @pending_tournaments.each do |tournament| %>
                <tr>
                  <td><%= tournament.display_code %></td>
                  <td>
                    <%= link_to tournament.name, tournament_path(tournament), target: "_blank", class: "text-decoration-none" %>
                  </td>
                  <td>
                    <%= tournament.organizer.name %>
                    <% if tournament.organizer.is_premium? %>
                      <span class="badge bg-info">프리미엄</span>
                    <% end %>
                  </td>
                  <td><%= tournament.tournament_start_at&.strftime("%Y-%m-%d") %></td>
                  <td><%= number_to_currency(tournament.entry_fee, unit: "₩", precision: 0) %></td>
                  <td><%= tournament.created_at.strftime("%Y-%m-%d %H:%M") %></td>
                  <td>
                    <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#approveModal<%= tournament.id %>">
                      승인
                    </button>
                    <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#rejectModal<%= tournament.id %>">
                      거절
                    </button>
                  </td>
                </tr>
                
                <!-- 승인 모달 -->
                <div class="modal fade" id="approveModal<%= tournament.id %>" tabindex="-1">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <%= form_with url: admin_tournament_action_path(tournament), method: :post, local: true do |f| %>
                        <%= f.hidden_field :action_type, value: 'approve' %>
                        <div class="modal-header">
                          <h5 class="modal-title">대회 승인</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                          <p>다음 대회를 승인하시겠습니까?</p>
                          <p><strong><%= tournament.name %></strong></p>
                          <div class="mb-3">
                            <%= f.label :approval_notes, "승인 메모 (선택사항)", class: "form-label" %>
                            <%= f.text_area :approval_notes, rows: 3, class: "form-control" %>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                          <%= f.submit "승인", class: "btn btn-success" %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </div>
                
                <!-- 거절 모달 -->
                <div class="modal fade" id="rejectModal<%= tournament.id %>" tabindex="-1">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <%= form_with url: admin_tournament_action_path(tournament), method: :post, local: true do |f| %>
                        <%= f.hidden_field :action_type, value: 'reject' %>
                        <div class="modal-header">
                          <h5 class="modal-title">대회 거절</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                          <p>다음 대회를 거절하시겠습니까?</p>
                          <p><strong><%= tournament.name %></strong></p>
                          <div class="mb-3">
                            <%= f.label :rejection_reason, "거절 사유", class: "form-label" %>
                            <%= f.text_area :rejection_reason, rows: 3, class: "form-control", required: true %>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                          <%= f.submit "거절", class: "btn btn-danger" %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>
  
  <!-- 전체 대회 목록 -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">전체 대회 목록</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>ID</th>
              <th>대회명</th>
              <th>상태</th>
              <th>주최자</th>
              <th>대회 일정</th>
              <th>참가팀</th>
              <th>참가비</th>
              <th>조회수</th>
              <th>등록일</th>
            </tr>
          </thead>
          <tbody>
            <% @tournaments.each do |tournament| %>
              <tr>
                <td><%= tournament.display_code %></td>
                <td>
                  <%= link_to tournament.name, tournament_path(tournament), target: "_blank", class: "text-decoration-none" %>
                  <% if tournament.is_featured %>
                    <span class="badge bg-warning">추천</span>
                  <% end %>
                </td>
                <td>
                  <span class="badge bg-<%= tournament_status_color(tournament.status) %>">
                    <%= tournament.status_text %>
                  </span>
                </td>
                <td>
                  <%= tournament.organizer.name %>
                  <% if tournament.organizer.admin? %>
                    <span class="badge bg-danger">관리자</span>
                  <% elsif tournament.organizer.is_premium? %>
                    <span class="badge bg-info">프리미엄</span>
                  <% end %>
                </td>
                <td><%= tournament.tournament_start_at&.strftime("%Y-%m-%d") %></td>
                <td>
                  <%= tournament.approved_teams.count %> / <%= tournament.max_teams %>
                </td>
                <td><%= number_to_currency(tournament.entry_fee, unit: "₩", precision: 0) %></td>
                <td><%= tournament.view_count %></td>
                <td><%= tournament.created_at.strftime("%Y-%m-%d") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      
      <%= paginate @tournaments %>
    </div>
  </div>
</div>

<style>
.admin-page {
  padding: 20px;
}

.page-header {
  margin-bottom: 30px;
}

.page-header h1 {
  font-size: 2rem;
  font-weight: bold;
  margin-bottom: 10px;
}

.page-subtitle {
  color: #6c757d;
  font-size: 1.1rem;
}

.admin-filters {
  background-color: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
}

.card {
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.badge {
  font-size: 0.75rem;
  padding: 0.25rem 0.5rem;
}
</style>