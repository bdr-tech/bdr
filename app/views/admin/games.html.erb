<% content_for :title, "Í≤ΩÍ∏∞ Í¥ÄÎ¶¨" %>

<!-- ÌéòÏù¥ÏßÄ Ï†úÎ™© -->
<div class="mb-8">
  <h2 class="text-3xl font-bold text-gray-800 mb-2">üèÄ Í≤ΩÍ∏∞ Í¥ÄÎ¶¨</h2>
  <p class="text-gray-600">Îì±Î°ùÎêú Í≤ΩÍ∏∞Îì§ÏùÑ Í¥ÄÎ¶¨ÌïòÍ≥† Î™®ÎãàÌÑ∞ÎßÅÌïòÏÑ∏Ïöî</p>
</div>

<!-- ÌïÑÌÑ∞ Î∞è Í≤ÄÏÉâ -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
  <%= form_with url: admin_games_path, method: :get, local: true, class: "flex flex-wrap gap-4 items-end" do |form| %>
    <div class="flex-1 min-w-64">
      <%= form.text_field :search, placeholder: "Í≤ΩÍ∏∞Î™Ö, Í≤ΩÍ∏∞ID Í≤ÄÏÉâ", 
                          value: params[:search], 
                          class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>
    <div>
      <%= form.select :status, 
                      options_for_select([
                        ['Ï†ÑÏ≤¥ ÏÉÅÌÉú', ''],
                        ['ÌôúÏÑ±', 'active'],
                        ['ÏôÑÎ£å', 'completed'],
                        ['Ï∑®ÏÜå', 'cancelled'],
                        ['ÏßÑÌñâÏ§ë', 'in_progress']
                      ], params[:status]), 
                      {}, 
                      { class: "px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" } %>
    </div>
    <div class="flex gap-2">
      <%= form.submit "Í≤ÄÏÉâ", class: "bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-300" %>
      <%= link_to "Ï¥àÍ∏∞Ìôî", admin_games_path, class: "bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition duration-300" %>
    </div>
  <% end %>
</div>

<!-- Í≤ΩÍ∏∞ Î™©Î°ù -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Í≤ΩÍ∏∞ Ï†ïÎ≥¥</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ìò∏Ïä§Ìä∏</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÏÉÅÌÉú</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ï∞∏Í∞ÄÏûê</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÏàòÏùµ</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÏùºÏ†ï</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Í¥ÄÎ¶¨</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <% @games.each do |game| %>
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10">
                  <div class="h-10 w-10 rounded-full bg-orange-500 flex items-center justify-center text-white font-bold">
                    üèÄ
                  </div>
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-900">
                    <%= link_to game.title, game_path(game), class: "text-blue-600 hover:text-blue-800" %>
                  </div>
                  <div class="text-sm text-gray-500">
                    ID: <%= game.game_id %>
                  </div>
                  <div class="text-sm text-gray-500">
                    <%= game.game_type %> ‚Ä¢ <%= game.court&.name || game.venue_name %>
                  </div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">
                <%= game.organizer.name %>
              </div>
              <div class="text-sm text-gray-500">
                <%= game.organizer.email %>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <% case game.status %>
              <% when 'active' %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  ÌôúÏÑ±
                </span>
              <% when 'completed' %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  ÏôÑÎ£å
                </span>
              <% when 'cancelled' %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                  Ï∑®ÏÜå
                </span>
              <% when 'in_progress' %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                  ÏßÑÌñâÏ§ë
                </span>
              <% else %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                  <%= game.status %>
                </span>
              <% end %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <div class="flex items-center">
                <div class="text-sm font-medium text-gray-900">
                  <%= game.confirmed_players_count %>/<%= game.max_players %>
                </div>
              </div>
              <div class="text-xs text-gray-500">
                Ïã†Ï≤≠: <%= game.game_applications.count %>Í±¥
              </div>
              <div class="text-xs text-gray-500">
                ÎåÄÍ∏∞: <%= game.game_applications.pending.count %>Í±¥
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <% if game.fee && game.fee > 0 %>
                <div class="text-sm font-medium text-gray-900">
                  <%= number_to_currency(game.fee, unit: '‚Ç©', precision: 0) %> √ó <%= game.confirmed_players_count %>
                </div>
                <div class="text-xs text-green-600">
                  Ï¥ù <%= number_to_currency(game.confirmed_players_count * game.fee, unit: '‚Ç©', precision: 0) %>
                </div>
              <% else %>
                <span class="text-gray-400">Î¨¥Î£å</span>
              <% end %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <div class="text-sm font-medium text-gray-900">
                <%= game.scheduled_at.strftime("%Y-%m-%d") %>
              </div>
              <div class="text-xs text-gray-500">
                <%= game.scheduled_at.strftime("%H:%M") %>
              </div>
              <div class="text-xs text-gray-400">
                <%= time_ago_in_words(game.created_at) %> Ï†Ñ ÏÉùÏÑ±
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <div class="flex space-x-2">
                <%= link_to "ÏÉÅÏÑ∏", game_path(game), class: "text-blue-600 hover:text-blue-800" %>
                
                <% if game.status == 'active' %>
                  <%= form_with url: admin_game_action_path(game), method: :post, local: true, class: "inline" do |f| %>
                    <%= f.hidden_field :action_type, value: 'cancel' %>
                    <%= f.submit "Ï∑®ÏÜå", class: "bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs", 
                                 confirm: "Ï†ïÎßêÎ°ú Ïù¥ Í≤ΩÍ∏∞Î•º Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?" %>
                  <% end %>
                <% elsif game.status == 'cancelled' %>
                  <%= form_with url: admin_game_action_path(game), method: :post, local: true, class: "inline" do |f| %>
                    <%= f.hidden_field :action_type, value: 'activate' %>
                    <%= f.submit "ÌôúÏÑ±Ìôî", class: "bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs", 
                                 confirm: "Ïù¥ Í≤ΩÍ∏∞Î•º Îã§Ïãú ÌôúÏÑ±ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?" %>
                  <% end %>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<% if @games.empty? %>
  <div class="bg-white rounded-lg shadow-md p-8 text-center">
    <div class="text-gray-500">
      <div class="text-4xl mb-4">üèÄ</div>
      <p class="text-lg">Ï°∞Í±¥Ïóê ÎßûÎäî Í≤ΩÍ∏∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
    </div>
  </div>
<% else %>
  <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
  <div class="mt-6 flex justify-center">
    <%= paginate @games %>
  </div>
<% end %>