# 🏀 BDR 플랫폼 기능 명세서

## 📋 목차
1. [사용자 플로우](#사용자-플로우)
2. [화면별 기능 설명](#화면별-기능-설명)
3. [API 엔드포인트](#api-엔드포인트)
4. [비즈니스 로직](#비즈니스-로직)

## 🔄 사용자 플로우

### 1. 게스트 사용자 플로우
```
홈페이지 접속 → 경기 목록 조회 → 경기 상세 보기 → 로그인 유도 → 회원가입/로그인
```

### 2. 일반 사용자 플로우
```
로그인 → 프로필 완성 → 경기 검색 → 경기 신청 → 호스트 승인 대기 → 결제 → 경기 참가
```

### 3. 호스트 사용자 플로우
```
로그인 → 새 경기 생성 → 신청자 관리 → 승인/거절 → 입금 확인 → 경기 진행 → 수익 정산
```

## 🖥️ 화면별 기능 설명

### 1. 홈페이지 (`/`)
**목적**: 플랫폼 소개 및 주요 경기 노출

**주요 기능**:
- 오늘의 경기 목록 (최대 5개)
- 근처 경기 추천
- 3초 룰 퀵 매치 기능
- 플랫폼 통계 표시

**접근 권한**: 전체 사용자

### 2. 경기 목록 (`/games`)
**목적**: 전체 경기 조회 및 필터링

**주요 기능**:
- 경기 목록 표시 (페이지네이션)
- 필터링: 날짜, 지역, 경기 유형, 레벨
- 검색: 경기명, 장소명
- 정렬: 날짜순, 거리순, 참가비순

**접근 권한**: 전체 사용자

### 3. 경기 상세 (`/games/:id`)
**목적**: 경기 상세 정보 및 참가 신청

**주요 기능**:
- 경기 정보 표시
- 참가자 목록
- 코트 정보
- 유니폼 색상 안내
- 참가 신청 (로그인 필요)
- 호스트 전용 신청자 관리

**접근 권한**: 전체 사용자 (신청은 로그인 필요)

### 4. 새 경기 생성 (`/games/new`)
**목적**: 새로운 경기 생성

**3단계 프로세스**:
1. **기본 정보**: 경기 유형, 팀명, 지역
2. **세부 내용**: 제목, 장소, 시간, 참가비, 유니폼 색상
3. **추가 요구사항**: 시설 요구사항, 메시지

**접근 권한**: 로그인 사용자

### 5. 프로필 (`/profile`)
**목적**: 개인 정보 관리 및 참가 이력 조회

**주요 기능**:
- 개인 정보 표시
- 프로필 완성도
- 신청 현황 (대기, 승인, 거절)
- 주최한 경기 목록
- 결제 필요 경기 (직접 결제 기능)
- 호스트 계좌 정보

**접근 권한**: 로그인 사용자

### 6. 프로필 수정 (`/profile/edit`)
**목적**: 개인 정보 수정

**수정 가능 항목**:
- 기본 정보: 이름, 닉네임, 연락처
- 신체 정보: 키, 몸무게
- 농구 정보: 포지션, 경력
- 지역 정보: 시/도, 구/군
- 계좌 정보: 은행, 계좌번호, 예금주

**접근 권한**: 로그인 사용자

### 7. 결제 페이지 (`/payments/new`)
**목적**: 참가비 결제 (현재 사용하지 않음 - 직접 결제로 대체)

**주요 기능**:
- TossPayments 통합
- 결제 정보 표시
- 결제 성공/실패 처리

**접근 권한**: 해당 경기 신청자

### 8. 커뮤니티 (`/posts`)
**목적**: 사용자 간 소통 및 정보 공유

**주요 기능**:
- 게시글 작성/조회
- 댓글 시스템
- 카테고리별 분류
- 검색 기능

**접근 권한**: 로그인 사용자 (조회는 전체 가능)

## 🔌 API 엔드포인트

### 인증 관련
```
POST   /sessions      # 로그인
DELETE /sessions      # 로그아웃
GET    /signup        # 회원가입 폼
POST   /signup        # 회원가입 처리
```

### 경기 관련
```
GET    /games                    # 경기 목록
GET    /games/:id                # 경기 상세
POST   /games                    # 경기 생성
GET    /games/new                # 경기 생성 폼
POST   /games/:id/apply          # 경기 신청
DELETE /games/:id/cancel         # 신청 취소
POST   /games/:id/approve        # 신청 승인 (호스트)
POST   /games/:id/reject         # 신청 거절 (호스트)
POST   /games/:id/confirm_payment # 입금 확인 (호스트)
```

### 사용자 관련
```
GET    /profile              # 프로필 조회
GET    /profile/edit         # 프로필 수정 폼
PATCH  /profile              # 프로필 업데이트
GET    /profile/history      # 경기 이력
GET    /profile/stats        # 통계 정보
```

### 결제 관련
```
GET    /payments/new             # 결제 페이지 (사용 안함)
POST   /payments/success         # 결제 성공 콜백
POST   /payments/fail            # 결제 실패 콜백
```

### 커뮤니티 관련
```
GET    /posts              # 게시글 목록
GET    /posts/:id          # 게시글 상세
POST   /posts              # 게시글 작성
GET    /posts/new          # 게시글 작성 폼
POST   /posts/:id/comments # 댓글 작성
```

## 🔧 비즈니스 로직

### 1. 경기 신청 프로세스

#### 1.1 신청 조건 검증
- 로그인 상태 확인
- 프로필 완성도 70% 이상
- 취소 제한 시간 경과 확인
- 경기 정원 확인
- 중복 신청 방지

#### 1.2 승인 프로세스
```
pending → approved → waiting_payment → final_approved
```

**상태별 설명**:
- `pending`: 신청 대기 상태
- `approved`: 호스트가 승인 (무료 경기는 바로 final_approved)
- `waiting_payment`: 결제 대기 상태 (유료 경기만)
- `final_approved`: 최종 승인 (경기 참가 확정)
- `rejected`: 거절 상태

### 2. 결제 시스템

#### 2.1 결제 플로우
```
신청 승인 → 결제 대기 → TossPayments 결제 → 결제 완료 → 최종 승인
```

#### 2.2 결제 방식
- **직접 결제**: 프로필 페이지에서 원클릭 결제
- **결제 대행**: TossPayments SDK v1 사용
- **수수료**: 플랫폼 수수료 5%

### 3. 호스트 수익 관리

#### 3.1 수익 계산
```
총 수익 = 최종 승인자 수 × 참가비
실제 수익 = 총 수익 × 95% (플랫폼 수수료 5% 제외)
```

#### 3.2 정산 주기
- 경기 완료 후 7일 이내 정산
- 호스트 계좌로 자동 송금 (예정)

### 4. 사용자 제재 시스템

#### 4.1 취소 제한
- 24시간 내 3회 취소 시 24시간 신청 제한
- 1주일 내 5회 취소 시 1주일 신청 제한

#### 4.2 계정 상태
- `active`: 정상 사용자
- `suspended`: 일시 정지
- `inactive`: 비활성화
- `banned`: 영구 정지

### 5. 경기 유형별 특성

#### 5.1 픽업게임
- 자유로운 참가/탈퇴
- 실시간 매칭
- 낮은 참가비 또는 무료

#### 5.2 게스트모집
- 호스트 승인 필요
- 정해진 시간과 장소
- 참가비 있음

#### 5.3 TvT연습경기
- 팀 단위 참가
- 높은 레벨 요구
- 정규 시간 경기

### 6. 데이터 무결성 규칙

#### 6.1 경기 생성 규칙
- 최소 2명 이상 모집
- 시작 시간 < 종료 시간
- 참가비 >= 0
- 유니폼 색상 최대 2개

#### 6.2 참가 신청 규칙
- 사용자당 경기당 1회 신청
- 경기 시작 30분 전까지 신청 가능
- 정원 초과 시 신청 불가

## 📊 성능 요구사항

### 1. 응답 시간
- 페이지 로딩: < 2초
- API 응답: < 500ms
- 결제 처리: < 10초

### 2. 동시 사용자
- 목표: 100명 동시 접속
- 최대: 500명 동시 접속

### 3. 데이터 용량
- 초기: 10,000개 경기
- 1년 후: 100,000개 경기

## 🔒 보안 요구사항

### 1. 인증 및 권한
- 세션 기반 인증
- CSRF 토큰 검증
- 권한별 접근 제어

### 2. 데이터 보호
- 개인정보 암호화
- 결제 정보 보안
- SQL 인젝션 방지

### 3. 외부 연동 보안
- TossPayments API 보안
- 클라이언트 키 관리
- 콜백 URL 검증

---
*최종 업데이트: 2025-07-18*